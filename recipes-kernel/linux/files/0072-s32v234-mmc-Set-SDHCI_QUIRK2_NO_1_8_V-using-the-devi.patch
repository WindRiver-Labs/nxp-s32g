From c76669abbfe2e1c7204fd28287c806bf83df0f6c Mon Sep 17 00:00:00 2001
From: Dan Nica <dan.nica@nxp.com>
Date: Mon, 15 Feb 2021 14:07:19 +0200
Subject: [PATCH 72/78] s32v234: mmc: Set SDHCI_QUIRK2_NO_1_8_V using the
 device-tree

Issue: ALB-5955
Signed-off-by: Dan Nica <dan.nica@nxp.com>
---
 arch/arm64/boot/dts/freescale/fsl-s32v234.dtsi | 3 ++-
 drivers/mmc/host/sdhci-esdhc-imx.c             | 3 ---
 2 files changed, 2 insertions(+), 4 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/fsl-s32v234.dtsi b/arch/arm64/boot/dts/freescale/fsl-s32v234.dtsi
index b1e2f504bd23..aaef2a42b095 100644
--- a/arch/arm64/boot/dts/freescale/fsl-s32v234.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-s32v234.dtsi
@@ -1,6 +1,6 @@
 /*
  * Copyright 2015 Freescale Semiconductor, Inc.
- * Copyright 2017-2020 NXP
+ * Copyright 2017-2021 NXP 
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
  * the Free Software Foundation; either version 2 of the License, or
@@ -393,6 +393,7 @@
 					 <&clks S32V234_CLK_SDHC>;
 				clock-names = "ipg", "ahb", "per";
 				bus-width = <8>;
+				no-1-8-v;
 				status = "disabled";
 			};
 
diff --git a/drivers/mmc/host/sdhci-esdhc-imx.c b/drivers/mmc/host/sdhci-esdhc-imx.c
index 255b500fb0e1..938eaf97fe2d 100755
--- a/drivers/mmc/host/sdhci-esdhc-imx.c
+++ b/drivers/mmc/host/sdhci-esdhc-imx.c
@@ -1665,9 +1665,6 @@ static int sdhci_esdhc_imx_probe(struct platform_device *pdev)
 
 	sdhci_esdhc_imx_hwinit(host);
 
-	if (is_s32v234_usdhc(imx_data))
-		host->quirks2 |= SDHCI_QUIRK2_NO_1_8_V;
-
 	if (host->mmc->pm_caps & MMC_PM_KEEP_POWER &&
 		host->mmc->pm_caps & MMC_PM_WAKE_SDIO_IRQ)
 		device_init_wakeup(&pdev->dev, 1);
-- 
2.25.1

