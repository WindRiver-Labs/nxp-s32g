From e69709e52f859069670d97b084c24823465099ea Mon Sep 17 00:00:00 2001
From: Larisa Grigore <larisa.grigore@nxp.com>
Date: Tue, 12 Jan 2021 17:19:48 +0200
Subject: [PATCH 41/78] serial:fsl_linflex: Fix CONFIG_DMA_API_DEBUG reported
 issues

Issue: ALB-6295
Signed-off-by: Larisa Grigore <larisa.grigore@nxp.com>
---
 drivers/tty/serial/fsl_linflexuart.c | 14 +++++++-------
 1 file changed, 7 insertions(+), 7 deletions(-)

diff --git a/drivers/tty/serial/fsl_linflexuart.c b/drivers/tty/serial/fsl_linflexuart.c
index 7363165f647d..bca0375aaa1b 100644
--- a/drivers/tty/serial/fsl_linflexuart.c
+++ b/drivers/tty/serial/fsl_linflexuart.c
@@ -256,7 +256,7 @@ static void linflex_copy_rx_to_tty(struct linflex_port *sport,
 	}
 
 	dma_sync_single_for_device(sport->port.dev, sport->dma_rx_buf_bus,
-			FSL_UART_RX_DMA_BUFFER_SIZE, DMA_TO_DEVICE);
+			FSL_UART_RX_DMA_BUFFER_SIZE, DMA_FROM_DEVICE);
 }
 
 static void linflex_enable_dma_rx(struct uart_port *port)
@@ -766,12 +766,12 @@ static int linflex_dma_tx_request(struct uart_port *port)
 	unsigned char *dma_buf;
 	int ret;
 
-	dma_bus = dma_map_single(sport->dma_tx_chan->device->dev,
+	dma_bus = dma_map_single(port->dev,
 				sport->port.state->xmit.buf,
 				UART_XMIT_SIZE, DMA_TO_DEVICE);
 
-	if (dma_mapping_error(sport->dma_tx_chan->device->dev, dma_bus)) {
-		dev_err(sport->port.dev, "dma_map_single tx failed\n");
+	if (dma_mapping_error(port->dev, dma_bus)) {
+		dev_err(port->dev, "dma_map_single tx failed\n");
 		return -ENOMEM;
 	}
 
@@ -812,11 +812,11 @@ static int linflex_dma_rx_request(struct uart_port *port)
 		return -ENOMEM;
 	}
 
-	dma_bus = dma_map_single(sport->dma_rx_chan->device->dev, dma_buf,
+	dma_bus = dma_map_single(port->dev, dma_buf,
 				FSL_UART_RX_DMA_BUFFER_SIZE, DMA_FROM_DEVICE);
 
-	if (dma_mapping_error(sport->dma_rx_chan->device->dev, dma_bus)) {
-		dev_err(sport->port.dev, "dma_map_single rx failed\n");
+	if (dma_mapping_error(port->dev, dma_bus)) {
+		dev_err(port->dev, "dma_map_single rx failed\n");
 		return -ENOMEM;
 	}
 
-- 
2.25.1

