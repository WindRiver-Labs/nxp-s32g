From 81fb199db7a3049986d7ac7366aab5a19a4f4568 Mon Sep 17 00:00:00 2001
From: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Date: Mon, 2 Aug 2021 08:35:47 +0300
Subject: [PATCH 30/49] can: Move LLCE CAN and Logger drivers into a new folder

commit 81fb199db7a3049986d7ac7366aab5a19a4f4568 from
https://source.codeaurora.org/external/autobsps32/linux

Upstream-Status: Pending

Issue: ALB-5830
Signed-off-by: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 drivers/net/can/Kconfig                  | 24 +---------------
 drivers/net/can/Makefile                 |  4 +--
 drivers/net/can/llce/Kconfig             | 36 ++++++++++++++++++++++++
 drivers/net/can/llce/Makefile            |  7 +++++
 drivers/net/can/{ => llce}/llce_can.c    |  0
 drivers/net/can/{ => llce}/llce_logger.c |  0
 6 files changed, 45 insertions(+), 26 deletions(-)
 create mode 100644 drivers/net/can/llce/Kconfig
 create mode 100644 drivers/net/can/llce/Makefile
 rename drivers/net/can/{ => llce}/llce_can.c (100%)
 rename drivers/net/can/{ => llce}/llce_logger.c (100%)

diff --git a/drivers/net/can/Kconfig b/drivers/net/can/Kconfig
index c79ac491c315..287aa0651093 100644
--- a/drivers/net/can/Kconfig
+++ b/drivers/net/can/Kconfig
@@ -1,17 +1,6 @@
 # SPDX-License-Identifier: GPL-2.0-only
 menu "CAN Device Drivers"
 
-config LLCE_LOGGER
-    tristate "LLCE Logging Driver"
-    depends on SOC_S32GEN1 && m
-    help
-        This driver is used on S32G2xx to log CAN messages received from LLCE.
-        It provides a interface to userspace, as a char device, on which you
-        can cat or you can echo a value to set the log size to that dimension.
-        Separate LLCE configuration for CAN is expected.
-
-        It assumes that the LLCE Firmware is already loaded.
-
 config CAN_VCAN
 	tristate "Virtual Local CAN Interface (vcan)"
 	help
@@ -112,18 +101,6 @@ config CAN_FLEXCAN
 	help
 	  Say Y here if you want to support for Freescale FlexCAN.
 
-config CAN_LLCE
-	tristate "NXP LLCE CAN"
-	select NXP_LLCE_MBOX
-	select LLCE_CORE
-	depends on CAN_DEV && m
-	help
-	  Driver for CAN interface of the NXP LLCE accelerator. The CAN
-	  interface is one of the offloaded communication channels of the
-	  Low Latency Communication Engine. The hardware channels abstract
-	  the communication that is fully supported through a
-	  firmware-defined host interface.
-
 config CAN_GRCAN
 	tristate "Aeroflex Gaisler GRCAN and GRHCAN CAN devices"
 	depends on OF && HAS_DMA
@@ -193,6 +170,7 @@ config PCH_CAN
 source "drivers/net/can/c_can/Kconfig"
 source "drivers/net/can/cc770/Kconfig"
 source "drivers/net/can/ifi_canfd/Kconfig"
+source "drivers/net/can/llce/Kconfig"
 source "drivers/net/can/m_can/Kconfig"
 source "drivers/net/can/mscan/Kconfig"
 source "drivers/net/can/peak_canfd/Kconfig"
diff --git a/drivers/net/can/Makefile b/drivers/net/can/Makefile
index 9d91b38b463a..1e391e57cc3c 100644
--- a/drivers/net/can/Makefile
+++ b/drivers/net/can/Makefile
@@ -3,8 +3,6 @@
 #  Makefile for the Linux Controller Area Network drivers.
 #
 
-obj-$(CONFIG_LLCE_LOGGER)	+= llce_logger.o
-
 obj-$(CONFIG_CAN_VCAN)		+= vcan.o
 obj-$(CONFIG_CAN_VXCAN)		+= vxcan.o
 obj-$(CONFIG_CAN_SLCAN)		+= slcan.o
@@ -19,11 +17,11 @@ obj-$(CONFIG_CAN_AT91)		+= at91_can.o
 obj-$(CONFIG_CAN_CC770)		+= cc770/
 obj-$(CONFIG_CAN_C_CAN)		+= c_can/
 obj-$(CONFIG_CAN_FLEXCAN)	+= flexcan.o
-obj-$(CONFIG_CAN_LLCE)		+= llce_can.o
 obj-$(CONFIG_CAN_GRCAN)		+= grcan.o
 obj-$(CONFIG_CAN_IFI_CANFD)	+= ifi_canfd/
 obj-$(CONFIG_CAN_JANZ_ICAN3)	+= janz-ican3.o
 obj-$(CONFIG_CAN_KVASER_PCIEFD)	+= kvaser_pciefd.o
+obj-$(CONFIG_CAN_LLCE)		+= llce/
 obj-$(CONFIG_CAN_MSCAN)		+= mscan/
 obj-$(CONFIG_CAN_M_CAN)		+= m_can/
 obj-$(CONFIG_CAN_PEAK_PCIEFD)	+= peak_canfd/
diff --git a/drivers/net/can/llce/Kconfig b/drivers/net/can/llce/Kconfig
new file mode 100644
index 000000000000..209f609d46f3
--- /dev/null
+++ b/drivers/net/can/llce/Kconfig
@@ -0,0 +1,36 @@
+# SPDX-License-Identifier: GPL-2.0-only
+menuconfig CAN_LLCE
+	select NXP_LLCE_MBOX
+	select LLCE_CORE
+	depends on CAN_DEV && m
+	bool "NXP LLCE CAN support"
+	help
+	  Say Y here if you want support for NXP LLCE CAN drivers.
+	  This is common support for devices that embed the NXP LLCE CAN IP.
+
+	  If unsure choose N.
+
+if CAN_LLCE
+
+config CAN_LLCE_CONTROLLER
+	tristate "LLCE CAN"
+	depends on m
+	help
+	  Driver for CAN interface of the NXP LLCE accelerator. The CAN
+	  interface is one of the offloaded communication channels of the
+	  Low Latency Communication Engine. The hardware channels abstract
+	  the communication that is fully supported through a
+	  firmware-defined host interface.
+
+config CAN_LLCE_LOGGER
+	tristate "LLCE CAN Logger"
+	depends on m
+	help
+	  This driver is used on S32G2xx to log CAN messages received from LLCE.
+	  It provides a interface to userspace, as a char device, on which you
+	  can cat or you can echo a value to set the log size to that dimension.
+	  Separate LLCE configuration for CAN is expected.
+
+	  It assumes that the LLCE Firmware is already loaded.
+
+endif
diff --git a/drivers/net/can/llce/Makefile b/drivers/net/can/llce/Makefile
new file mode 100644
index 000000000000..2a4907dfcd74
--- /dev/null
+++ b/drivers/net/can/llce/Makefile
@@ -0,0 +1,7 @@
+# SPDX-License-Identifier: GPL-2.0
+#
+#  Makefile for the NXP LLCE CAN drivers
+#
+obj-$(CONFIG_CAN_LLCE_CONTROLLER)	+= llce_can.o
+obj-$(CONFIG_CAN_LLCE_LOGGER)		+= llce_logger.o
+
diff --git a/drivers/net/can/llce_can.c b/drivers/net/can/llce/llce_can.c
similarity index 100%
rename from drivers/net/can/llce_can.c
rename to drivers/net/can/llce/llce_can.c
diff --git a/drivers/net/can/llce_logger.c b/drivers/net/can/llce/llce_logger.c
similarity index 100%
rename from drivers/net/can/llce_logger.c
rename to drivers/net/can/llce/llce_logger.c
-- 
2.17.1

