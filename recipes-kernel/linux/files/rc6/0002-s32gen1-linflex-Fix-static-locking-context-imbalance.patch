From 42d0a6a6ac3367cc2920256fe40f4decf6043df0 Mon Sep 17 00:00:00 2001
From: Ciprian Marian Costea <ciprianmarian.costea@nxp.com>
Date: Tue, 17 Aug 2021 14:15:19 +0300
Subject: [PATCH 02/19] s32gen1: linflex: Fix static locking context imbalance

commit 42d0a6a6ac3367cc2920256fe40f4decf6043df0 from
https://source.codeaurora.org/external/autobsps32/linux

Upstream-Status: Pending

Issue: ALB-7523
Signed-off-by: Ciprian Marian Costea <ciprianmarian.costea@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 drivers/tty/serial/fsl_linflexuart.c | 13 +++++--------
 1 file changed, 5 insertions(+), 8 deletions(-)

diff --git a/drivers/tty/serial/fsl_linflexuart.c b/drivers/tty/serial/fsl_linflexuart.c
index 83c9b3ef6a8f..6c99e31edfb6 100644
--- a/drivers/tty/serial/fsl_linflexuart.c
+++ b/drivers/tty/serial/fsl_linflexuart.c
@@ -1329,17 +1329,14 @@ linflex_console_write(struct console *co, const char *s, unsigned int count)
 {
 	struct linflex_port *sport = linflex_ports[co->index];
 	unsigned long flags;
-	int locked = 1;
 
-	if (sport->port.sysrq)
-		locked = 0;
-	else
+	if (sport->port.sysrq) {
+		linflex_string_write(sport, s, count);
+	} else {
 		spin_lock_irqsave(&sport->port.lock, flags);
-
-	linflex_string_write(sport, s, count);
-
-	if (locked)
+		linflex_string_write(sport, s, count);
 		spin_unlock_irqrestore(&sport->port.lock, flags);
+	}
 }
 
 /*
-- 
2.17.1

