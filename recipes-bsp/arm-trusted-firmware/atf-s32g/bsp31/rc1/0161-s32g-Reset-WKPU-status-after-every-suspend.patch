From 5903b72b85d4d8260b6eb0f34c18a700a8fdde8e Mon Sep 17 00:00:00 2001
From: Ghennadi Procopciuc <Ghennadi.Procopciuc@nxp.com>
Date: Wed, 15 Jul 2020 06:44:03 +0300
Subject: [PATCH 161/269] s32g: Reset WKPU status after every suspend

Issue: ALB-4910
Upstream-Status: Pending 

Signed-off-by: Ghennadi Procopciuc <Ghennadi.Procopciuc@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 drivers/nxp/s32g/s32g_wkpu.c            | 9 ++++++++-
 include/drivers/nxp/s32g/s32gen1-wkpu.h | 1 +
 2 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/drivers/nxp/s32g/s32g_wkpu.c b/drivers/nxp/s32g/s32g_wkpu.c
index f20f15fb9..32ae50773 100644
--- a/drivers/nxp/s32g/s32g_wkpu.c
+++ b/drivers/nxp/s32g/s32g_wkpu.c
@@ -38,6 +38,14 @@ struct s32gen1_wkpu {
 	uint32_t pullups; /* Pull-ups / Pull-downs */
 };
 
+static struct s32gen1_wkpu wkpu;
+
+void s32gen1_wkpu_reset(void)
+{
+	/* Clear all interrupts */
+	mmio_write_32(wkpu.dt_info.base + WKPU_WISR, WKPU_WISR_MASK);
+}
+
 static void init_wkpu(struct s32gen1_wkpu *wkpu)
 {
 	uint32_t rising, falling;
@@ -136,7 +144,6 @@ static int init_from_dt(void *fdt, int fdt_offset, struct s32gen1_wkpu *wkpu)
 int s32gen1_wkpu_init(void *fdt, int fdt_offset)
 {
 	int ret;
-	struct s32gen1_wkpu wkpu;
 
 	ret = init_from_dt(fdt, fdt_offset, &wkpu);
 	if (ret)
diff --git a/include/drivers/nxp/s32g/s32gen1-wkpu.h b/include/drivers/nxp/s32g/s32gen1-wkpu.h
index 65e219476..13fadac94 100644
--- a/include/drivers/nxp/s32g/s32gen1-wkpu.h
+++ b/include/drivers/nxp/s32g/s32gen1-wkpu.h
@@ -6,5 +6,6 @@
 #define S32GEN1_WKPU_H
 
 int s32gen1_wkpu_init(void *fdt, int fdt_offset);
+void s32gen1_wkpu_reset(void);
 
 #endif
-- 
2.17.1

