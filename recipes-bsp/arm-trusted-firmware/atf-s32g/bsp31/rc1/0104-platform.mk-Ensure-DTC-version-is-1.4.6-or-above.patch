From cedb9f90bcb67929d108cf0cccfc6159ed594878 Mon Sep 17 00:00:00 2001
From: Dan Nica <dan.nica@nxp.com>
Date: Sat, 2 May 2020 11:44:40 +0300
Subject: [PATCH 104/269] platform.mk: Ensure DTC version is 1.4.6 or above

Issue: ALB-4887
Upstream-Status: Pending 

Signed-off-by: Dan Nica <dan.nica@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 plat/s32g/platform.mk | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/plat/s32g/platform.mk b/plat/s32g/platform.mk
index 7b6601f7c..d330cb45f 100644
--- a/plat/s32g/platform.mk
+++ b/plat/s32g/platform.mk
@@ -71,6 +71,15 @@ DTB_FILE_NAME		?= s32g274aevb.dtb
 FDT_SOURCES             := $(addprefix fdts/, $(patsubst %.dtb,%.dts,$(DTB_FILE_NAME)))
 DTC_FLAGS		+= -Wno-unit_address_vs_reg
 
+all: check_dtc_version
+check_dtc_version:
+	$(eval DTC_VERSION_RAW = $(shell $(DTC) --version | cut -f3 -d" "))
+	$(eval DTC_VERSION = $(shell echo $(DTC_VERSION_RAW) | sed "s/\./0/g"))
+	@if [ ${DTC_VERSION} -lt 10406 ]; then \
+		echo "$(DTC) version must be 1.4.6 or above"; \
+		false; \
+	fi
+
 # Disable the PSCI platform compatibility layer
 ENABLE_PLAT_COMPAT	:= 0
 
-- 
2.17.1

