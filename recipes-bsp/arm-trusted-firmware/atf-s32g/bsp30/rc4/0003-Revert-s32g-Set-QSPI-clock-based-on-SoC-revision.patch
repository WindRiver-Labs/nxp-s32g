From ad627b39a46407f5eb071ee1e314c94905480a0c Mon Sep 17 00:00:00 2001
From: Larisa Grigore <larisa.grigore@nxp.com>
Date: Thu, 1 Jul 2021 11:12:14 +0300
Subject: [PATCH 03/18] Revert "s32g: Set QSPI clock based on SoC revision"

This reverts commit a68856476c4c97e040a2f57b14b7746fac56347a.

Upstream-Status: Pending

Issue: ALB-7394
Signed-off-by: Larisa Grigore <larisa.grigore@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 drivers/nxp/s32g/clk/early_clocks.c           | 25 -------------------
 .../dt-bindings/clock/s32gen1-clock-freq.h    |  2 --
 plat/nxp/s32g/include/s32g_clocks.h           |  1 -
 plat/nxp/s32g/s32g_bl31.c                     |  1 -
 4 files changed, 29 deletions(-)

diff --git a/drivers/nxp/s32g/clk/early_clocks.c b/drivers/nxp/s32g/clk/early_clocks.c
index 5f82c0663..1bfcb6ae9 100644
--- a/drivers/nxp/s32g/clk/early_clocks.c
+++ b/drivers/nxp/s32g/clk/early_clocks.c
@@ -67,9 +67,6 @@ static struct clk mc_cgm0_mux14 = CLK_INIT(S32GEN1_CLK_MC_CGM0_MUX14);
 static struct clk lin_baud = CLK_INIT(S32GEN1_CLK_LIN_BAUD);
 static struct clk sdhc = CLK_INIT(S32GEN1_CLK_SDHC);
 
-/* QSPI */
-static struct clk qspi2x = CLK_INIT(S32GEN1_CLK_QSPI_2X);
-
 /* DDR clock */
 static struct clk ddr_pll_mux = CLK_INIT(S32GEN1_CLK_DDR_PLL_MUX);
 static struct clk ddr_pll_vco = CLK_INIT(S32GEN1_CLK_DDR_PLL_VCO);
@@ -175,28 +172,6 @@ static int enable_sdhc_clock(void)
 	return s32gen1_enable(&sdhc, 1);
 }
 
-int s32g_correct_qspi_clock(void)
-{
-	int ret;
-	unsigned long rate, freq;
-
-	if (is_s32gen1_soc_rev1())
-		freq = S32G274A_QSPI_FREQ * 2;
-	else
-		freq = S32G274A_REV2_QSPI_FREQ * 2;
-
-	ret = s32gen1_enable(&qspi2x, 0);
-	if (ret)
-		return ret;
-
-	rate = s32gen1_set_rate(&qspi2x, freq);
-	if (rate != freq)
-		return -EINVAL;
-
-	return s32gen1_enable(&qspi2x, 1);
-
-}
-
 int s32g_enable_ddr_clock(void)
 {
 	int ret;
diff --git a/include/dt-bindings/clock/s32gen1-clock-freq.h b/include/dt-bindings/clock/s32gen1-clock-freq.h
index 286cf098c..19843da34 100644
--- a/include/dt-bindings/clock/s32gen1-clock-freq.h
+++ b/include/dt-bindings/clock/s32gen1-clock-freq.h
@@ -23,7 +23,5 @@
 #define S32GEN1_PERIPH_PLL_PHI2_MIN_FREQ	(40 * MHZ)
 #define S32GEN1_PERIPH_DFS3_FREQ		(800 * MHZ)
 #define S32GEN1_QSPI_CLK_FREQ			(200 * MHZ)
-#define S32G274A_REV2_QSPI_FREQ			(200 * MHZ)
-#define S32G274A_QSPI_FREQ			(133333333)
 
 #endif
diff --git a/plat/nxp/s32g/include/s32g_clocks.h b/plat/nxp/s32g/include/s32g_clocks.h
index cf7dc85df..8ba8871aa 100644
--- a/plat/nxp/s32g/include/s32g_clocks.h
+++ b/plat/nxp/s32g/include/s32g_clocks.h
@@ -348,7 +348,6 @@ void s32g_sw_clks2firc(void);
 void s32g_disable_dfs(enum s32g_dfs_type dfs);
 void s32g_disable_pll(enum s32g_pll_type pll, uint32_t ndivs);
 void s32g_disable_fxosc(void);
-int s32g_correct_qspi_clock(void);
 
 int sw_mux_clk_config(enum s32g_mc_cgm cgm, uint8_t mux, uint8_t source);
 
diff --git a/plat/nxp/s32g/s32g_bl31.c b/plat/nxp/s32g/s32g_bl31.c
index 0c3afb4b3..79647c639 100644
--- a/plat/nxp/s32g/s32g_bl31.c
+++ b/plat/nxp/s32g/s32g_bl31.c
@@ -445,7 +445,6 @@ void bl31_platform_setup(void)
 	s32g_gic_setup();
 
 	dt_clk_init();
-	s32g_correct_qspi_clock();
 }
 
 /* TODO: Last-minute modifications before exiting BL31:
-- 
2.17.1

