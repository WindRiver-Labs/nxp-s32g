From 8df169aca70a0491adc98a70ad8bbf3df88df900 Mon Sep 17 00:00:00 2001
From: Larisa Grigore <larisa.grigore@nxp.com>
Date: Thu, 1 Jul 2021 15:28:36 +0300
Subject: [PATCH 06/18] s32g3: Add fdt file

Upstream-Status: Pending

Issue: ALB-7394
Signed-off-by: Larisa Grigore <larisa.grigore@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 fdts/fsl-s32-gen1.dtsi    |  11 ----
 fdts/fsl-s32g.dtsi        |  59 +++++++++++++++++++++
 fdts/fsl-s32g274a.dtsi    | 107 +++++++++++++++++++++++++-------------
 fdts/fsl-s32g398a-rdb.dts |  11 ++++
 fdts/fsl-s32g398a.dtsi    | 103 ++++++++++++++++++++++++++++++++++++
 5 files changed, 244 insertions(+), 47 deletions(-)
 create mode 100644 fdts/fsl-s32g.dtsi
 create mode 100644 fdts/fsl-s32g398a-rdb.dts
 create mode 100644 fdts/fsl-s32g398a.dtsi

diff --git a/fdts/fsl-s32-gen1.dtsi b/fdts/fsl-s32-gen1.dtsi
index 6b57ca908..b7ccc5014 100644
--- a/fdts/fsl-s32-gen1.dtsi
+++ b/fdts/fsl-s32-gen1.dtsi
@@ -338,17 +338,6 @@
 				 * value can be 266666666.
 				 */
 				<400000000>;
-
-			clocks = <&clks S32GEN1_CLK_XBAR_2X>,
-				<&clks S32GEN1_CLK_SERDES_REF>,
-				<&clks S32GEN1_CLK_PER>,
-				<&clks S32GEN1_CLK_FTM0_REF>,
-				<&clks S32GEN1_CLK_FTM1_REF>,
-				<&clks S32GEN1_CLK_CAN_PE>,
-				<&clks S32GEN1_CLK_LIN_BAUD>,
-				<&clks S32GEN1_CLK_SPI>,
-				<&clks S32GEN1_CLK_SDHC>,
-				<&clks S32GEN1_CLK_QSPI_2X>;
 		};
 
 		mc_cgm1: mc_cgm1@40034000 {
diff --git a/fdts/fsl-s32g.dtsi b/fdts/fsl-s32g.dtsi
new file mode 100644
index 000000000..82376f44c
--- /dev/null
+++ b/fdts/fsl-s32g.dtsi
@@ -0,0 +1,59 @@
+/*
+ * Copyright 2020-2021 NXP
+ *
+ * SPDX-License-Identifier: BSD-3-Clause
+ */
+
+#include <dt-bindings/clock/s32g-clock.h>
+
+/dts-v1/;
+#include "fsl-s32-gen1.dtsi"
+/ {
+	model = "NXP S32G";
+	compatible = "fsl,s32g274a-simu", "fsl,s32g274a", "fsl,s32gen1",
+		     "arm,vexpress,v2p-aarch64", "arm,vexpress";
+};
+
+&clks {
+	clocks = <&clks S32GEN1_CLK_PER>,
+		<&clks S32GEN1_CLK_FTM0_REF>,
+		<&clks S32GEN1_CLK_FTM1_REF>,
+		<&clks S32GEN1_CLK_CAN_PE>,
+		<&clks S32GEN1_CLK_XBAR_2X>,
+		<&clks S32GEN1_CLK_XBAR>,
+		<&clks S32GEN1_CLK_XBAR_DIV2>,
+		<&clks S32GEN1_CLK_XBAR_DIV3>,
+		<&clks S32GEN1_CLK_XBAR_DIV4>,
+		<&clks S32GEN1_CLK_XBAR_DIV6>,
+		<&clks S32GEN1_CLK_SPI>,
+		<&clks S32GEN1_CLK_QSPI>;
+
+	mc_cgm2: mc_cgm2@44018000 {
+		compatible = "fsl,s32gen1-mc_cgm2";
+		reg = <0x0 0x44018000 0x0 0x3000>;
+
+		assigned-clocks =
+			<&clks S32G_CLK_MC_CGM2_MUX0>,
+			<&clks S32G_CLK_PFE_PE>;
+		assigned-clock-rates =
+			<0>,
+			<600000000>;
+		assigned-clock-parents =
+			<&clks S32G_CLK_ACCEL_PLL_PHI1>;
+	};
+};
+
+&accelpll {
+	assigned-clocks =
+		<&clks S32GEN1_CLK_ACCEL_PLL_MUX>,
+		<&clks S32GEN1_CLK_ACCEL_PLL_VCO>,
+		<&clks S32G_CLK_ACCEL_PLL_PHI0>,
+		<&clks S32G_CLK_ACCEL_PLL_PHI1>;
+	assigned-clock-parents =
+		<&clks S32GEN1_CLK_FXOSC>;
+	assigned-clock-rates =
+		<0>,
+		<1800000000>,
+		<600000000>,
+		<600000000>;
+};
diff --git a/fdts/fsl-s32g274a.dtsi b/fdts/fsl-s32g274a.dtsi
index 9a3961197..e1ce5bbdc 100644
--- a/fdts/fsl-s32g274a.dtsi
+++ b/fdts/fsl-s32g274a.dtsi
@@ -7,7 +7,7 @@
 #include <dt-bindings/clock/s32g-clock.h>
 
 /dts-v1/;
-#include "fsl-s32-gen1.dtsi"
+#include "fsl-s32g.dtsi"
 / {
 	model = "NXP S32G";
 	compatible = "fsl,s32g274a-simu", "fsl,s32g274a", "fsl,s32gen1",
@@ -15,47 +15,82 @@
 };
 
 &clks {
-	clocks = <&clks S32GEN1_CLK_PER>,
-		<&clks S32GEN1_CLK_FTM0_REF>,
-		<&clks S32GEN1_CLK_FTM1_REF>,
-		<&clks S32GEN1_CLK_CAN_PE>,
-		<&clks S32GEN1_CLK_XBAR_2X>,
-		<&clks S32GEN1_CLK_XBAR>,
-		<&clks S32GEN1_CLK_XBAR_DIV2>,
-		<&clks S32GEN1_CLK_XBAR_DIV3>,
-		<&clks S32GEN1_CLK_XBAR_DIV4>,
-		<&clks S32GEN1_CLK_XBAR_DIV6>,
-		<&clks S32GEN1_CLK_SPI>,
-		<&clks S32GEN1_CLK_QSPI>;
 
-	mc_cgm2: mc_cgm2@44018000 {
-		compatible = "fsl,s32gen1-mc_cgm2";
-		reg = <0x0 0x44018000 0x0 0x3000>;
+	mc_cgm0: mc_cgm0@40030000 {
+		compatible = "fsl,s32gen1-mc_cgm0";
+		reg = <0x0 0x40030000 0x0 0x3000>;
 
 		assigned-clocks =
-			<&clks S32G_CLK_MC_CGM2_MUX0>,
-			<&clks S32G_CLK_PFE_PE>;
+			<&clks S32GEN1_CLK_MC_CGM0_MUX0>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX3>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX4>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX5>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX7>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX8>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX9>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX10>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX12>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX14>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX16>,
+			<&clks S32GEN1_CLK_XBAR_2X>,
+			<&clks S32GEN1_CLK_PER>,
+			<&clks S32GEN1_CLK_FTM0_REF>,
+			<&clks S32GEN1_CLK_FTM1_REF>,
+			<&clks S32GEN1_CLK_CAN_PE>,
+			<&clks S32GEN1_CLK_LIN_BAUD>,
+			<&clks S32GEN1_CLK_GMAC0_TS>,
+			<&clks S32GEN1_CLK_SPI>,
+			<&clks S32GEN1_CLK_SDHC>,
+			<&clks S32GEN1_CLK_QSPI_2X>;
+		assigned-clock-parents =
+			<&clks S32GEN1_CLK_ARM_PLL_DFS1>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_PHI1>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_PHI1>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_PHI1>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_PHI2>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_PHI3>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_PHI4>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_PHI5>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_DFS1>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_DFS3>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_PHI7>;
 		assigned-clock-rates =
 			<0>,
-			<600000000>;
-		assigned-clock-parents =
-			<&clks S32G_CLK_ACCEL_PLL_PHI1>;
-	};
-};
+			<0>,
+			<0>,
+			<0>,
+			<0>,
+			<0>,
+			<0>,
+			<0>,
+			<0>,
+			<0>,
+			<0>,
+			<S32GEN1_XBAR_2X_FREQ>,
+			<80000000>,
+			<40000000>,
+			<40000000>,
+			<80000000>,
+			<125000000>,
+			<200000000>,
+			<100000000>,
+			<400000000>,
+			/* If S32G274A Rev < 2, CLK_QSPI_2X maximum
+			 * value can be 266666666.
+			 */
+			<400000000>;
 
-&accelpll {
-	assigned-clocks =
-		<&clks S32GEN1_CLK_ACCEL_PLL_MUX>,
-		<&clks S32GEN1_CLK_ACCEL_PLL_VCO>,
-		<&clks S32G_CLK_ACCEL_PLL_PHI0>,
-		<&clks S32G_CLK_ACCEL_PLL_PHI1>;
-	assigned-clock-parents =
-		<&clks S32GEN1_CLK_FXOSC>;
-	assigned-clock-rates =
-		<0>,
-		<1800000000>,
-		<600000000>,
-		<600000000>;
+		clocks = <&clks S32GEN1_CLK_XBAR_2X>,
+			<&clks S32GEN1_CLK_SERDES_REF>,
+			<&clks S32GEN1_CLK_PER>,
+			<&clks S32GEN1_CLK_FTM0_REF>,
+			<&clks S32GEN1_CLK_FTM1_REF>,
+			<&clks S32GEN1_CLK_CAN_PE>,
+			<&clks S32GEN1_CLK_LIN_BAUD>,
+			<&clks S32GEN1_CLK_SPI>,
+			<&clks S32GEN1_CLK_SDHC>,
+			<&clks S32GEN1_CLK_QSPI_2X>;
+	};
 };
 
 &ocotp {
diff --git a/fdts/fsl-s32g398a-rdb.dts b/fdts/fsl-s32g398a-rdb.dts
new file mode 100644
index 000000000..c8ef598ea
--- /dev/null
+++ b/fdts/fsl-s32g398a-rdb.dts
@@ -0,0 +1,11 @@
+/*
+ * Copyright 2021 NXP
+ *
+ * SPDX-License-Identifier: BSD-3-Clause
+ */
+/dts-v1/;
+#include "fsl-s32g398a.dtsi"
+
+/ {
+	compatible = "fsl,s32g398ardb";
+};
diff --git a/fdts/fsl-s32g398a.dtsi b/fdts/fsl-s32g398a.dtsi
new file mode 100644
index 000000000..2f336d571
--- /dev/null
+++ b/fdts/fsl-s32g398a.dtsi
@@ -0,0 +1,103 @@
+/*
+ * Copyright 2021 NXP
+ *
+ * SPDX-License-Identifier: BSD-3-Clause
+ */
+
+#include <dt-bindings/clock/s32g3-clock.h>
+
+/dts-v1/;
+#include "fsl-s32g.dtsi"
+/ {
+	model = "NXP S32G";
+	compatible = "fsl,s32g398a", "fsl,s32gen1",
+		     "arm,vexpress,v2p-aarch64", "arm,vexpress";
+};
+
+&clks {
+
+	mc_cgm0: mc_cgm0@40030000 {
+		compatible = "fsl,s32gen1-mc_cgm0";
+		reg = <0x0 0x40030000 0x0 0x3000>;
+
+		assigned-clocks =
+			<&clks S32GEN1_CLK_MC_CGM0_MUX0>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX3>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX4>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX5>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX7>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX8>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX12>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX14>,
+			<&clks S32GEN1_CLK_MC_CGM0_MUX16>,
+			<&clks S32GEN1_CLK_PER>,
+			<&clks S32GEN1_CLK_XBAR_2X>,
+			<&clks S32GEN1_CLK_FTM0_REF>,
+			<&clks S32GEN1_CLK_FTM1_REF>,
+			<&clks S32GEN1_CLK_CAN_PE>,
+			<&clks S32GEN1_CLK_LIN_BAUD>,
+			<&clks S32GEN1_CLK_SPI>,
+			<&clks S32GEN1_CLK_QSPI_2X>,
+			<&clks S32GEN1_CLK_SDHC>;
+		assigned-clock-parents =
+			<&clks S32GEN1_CLK_ARM_PLL_DFS1>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_PHI1>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_PHI1>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_PHI1>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_PHI2>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_PHI3>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_DFS1>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_DFS3>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_PHI7>;
+		assigned-clock-rates =
+			<0>,
+			<0>,
+			<0>,
+			<0>,
+			<0>,
+			<0>,
+			<0>,
+			<0>,
+			<0>,
+			<80000000>,
+			<S32GEN1_XBAR_2X_FREQ>,
+			<40000000>,
+			<40000000>,
+			<80000000>,
+			<125000000>,
+			<100000000>,
+			<400000000>,
+			<400000000>;
+
+		clocks = <&clks S32GEN1_CLK_XBAR_2X>,
+			<&clks S32GEN1_CLK_SERDES_REF>,
+			<&clks S32GEN1_CLK_PER>,
+			<&clks S32GEN1_CLK_FTM0_REF>,
+			<&clks S32GEN1_CLK_FTM1_REF>,
+			<&clks S32GEN1_CLK_CAN_PE>,
+			<&clks S32GEN1_CLK_LIN_BAUD>,
+			<&clks S32GEN1_CLK_SPI>,
+			<&clks S32GEN1_CLK_SDHC>,
+			<&clks S32GEN1_CLK_QSPI_2X>;
+	};
+
+	mc_cgm6: mc_cgm0@4053C000 {
+		compatible = "fsl,s32gen1-mc_cgm6";
+		reg = <0x0 0x4053C000 0x0 0x3000>;
+
+		assigned-clocks =
+			<&clks S32G_CLK_MC_CGM6_MUX0>,
+			<&clks S32G_CLK_MC_CGM6_MUX1>,
+			<&clks S32G_CLK_MC_CGM6_MUX2>,
+			<&clks S32GEN1_CLK_GMAC0_TS>;
+		assigned-clock-parents =
+			<&clks S32GEN1_CLK_PERIPH_PLL_PHI4>,
+			<&clks S32GEN1_CLK_PERIPH_PLL_PHI5>,
+			<&clks S32GEN1_CLK_GMAC0_EXT_RX>;
+		assigned-clock-rates =
+			<0>,
+			<0>,
+			<0>,
+			<200000000>;
+	};
+};
-- 
2.17.1

