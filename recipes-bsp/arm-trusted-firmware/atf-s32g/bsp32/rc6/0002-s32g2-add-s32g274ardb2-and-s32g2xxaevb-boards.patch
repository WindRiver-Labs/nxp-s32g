From 34230d33174c53f590e79f03f7871baf2c7bb8b2 Mon Sep 17 00:00:00 2001
From: Bogdan-Gabriel Roman <bogdan-gabriel.roman@nxp.com>
Date: Fri, 28 Jan 2022 15:38:34 +0200
Subject: [PATCH 2/6] s32g2: add s32g274ardb2 and s32g2xxaevb boards

Issue: ALB-8443
Upstream-Status: Pending 

Signed-off-by: Bogdan-Gabriel Roman <bogdan-gabriel.roman@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 fdts/fsl-s32g-rdb.dtsi                            |  6 ++++--
 ...fsl-s32g274a-rdb.dts => fsl-s32g274a-rdb2.dts} |  6 +-----
 fdts/fsl-s32g2xxa-evb.dts                         | 15 +++++++++++++++
 .../{platform_def.h => s32g2_platform_def.h}      |  8 ++++----
 plat/nxp/s32/s32g/s32g2/{platform.mk => s32g2.mk} |  7 +++----
 .../s32g2/s32g274ardb2/include/platform_def.h     | 11 +++++++++++
 plat/nxp/s32/s32g/s32g2/s32g274ardb2/platform.mk  | 11 +++++++++++
 .../s32g/s32g2/s32g2xxaevb/include/platform_def.h | 11 +++++++++++
 plat/nxp/s32/s32g/s32g2/s32g2xxaevb/platform.mk   | 11 +++++++++++
 9 files changed, 71 insertions(+), 15 deletions(-)
 rename fdts/{fsl-s32g274a-rdb.dts => fsl-s32g274a-rdb2.dts} (73%)
 create mode 100644 fdts/fsl-s32g2xxa-evb.dts
 rename plat/nxp/s32/s32g/s32g2/include/{platform_def.h => s32g2_platform_def.h} (85%)
 rename plat/nxp/s32/s32g/s32g2/{platform.mk => s32g2.mk} (89%)
 create mode 100644 plat/nxp/s32/s32g/s32g2/s32g274ardb2/include/platform_def.h
 create mode 100644 plat/nxp/s32/s32g/s32g2/s32g274ardb2/platform.mk
 create mode 100644 plat/nxp/s32/s32g/s32g2/s32g2xxaevb/include/platform_def.h
 create mode 100644 plat/nxp/s32/s32g/s32g2/s32g2xxaevb/platform.mk

diff --git a/fdts/fsl-s32g-rdb.dtsi b/fdts/fsl-s32g-rdb.dtsi
index 39ed770fd..7f03da6b6 100644
--- a/fdts/fsl-s32g-rdb.dtsi
+++ b/fdts/fsl-s32g-rdb.dtsi
@@ -1,5 +1,5 @@
 /*
- * Copyright 2021 NXP
+ * Copyright 2021-2022 NXP
  *
  * SPDX-License-Identifier: BSD-3-Clause
  */
@@ -23,4 +23,6 @@
 
 };
 
-
+&wkpu {
+	status = "okay";
+};
diff --git a/fdts/fsl-s32g274a-rdb.dts b/fdts/fsl-s32g274a-rdb2.dts
similarity index 73%
rename from fdts/fsl-s32g274a-rdb.dts
rename to fdts/fsl-s32g274a-rdb2.dts
index cf3e57afd..d11087d3f 100644
--- a/fdts/fsl-s32g274a-rdb.dts
+++ b/fdts/fsl-s32g274a-rdb2.dts
@@ -1,5 +1,5 @@
 /*
- * Copyright 2020-2021 NXP
+ * Copyright 2020-2022 NXP
  *
  * SPDX-License-Identifier: BSD-3-Clause
  */
@@ -10,7 +10,3 @@
 / {
 	compatible = "fsl,s32g274ardb";
 };
-
-&wkpu {
-	status = "okay";
-};
diff --git a/fdts/fsl-s32g2xxa-evb.dts b/fdts/fsl-s32g2xxa-evb.dts
new file mode 100644
index 000000000..7bbd970da
--- /dev/null
+++ b/fdts/fsl-s32g2xxa-evb.dts
@@ -0,0 +1,15 @@
+/*
+ * Copyright 2022 NXP
+ *
+ * SPDX-License-Identifier: BSD-3-Clause
+ */
+/dts-v1/;
+#include "fsl-s32g274a.dtsi"
+
+/ {
+	compatible = "fsl,s32g2xxaevb";
+};
+
+&i2c4 {
+	status = "disabled";
+};
diff --git a/plat/nxp/s32/s32g/s32g2/include/platform_def.h b/plat/nxp/s32/s32g/s32g2/include/s32g2_platform_def.h
similarity index 85%
rename from plat/nxp/s32/s32g/s32g2/include/platform_def.h
rename to plat/nxp/s32/s32g/s32g2/include/s32g2_platform_def.h
index 1700a70e0..065f0e5d9 100644
--- a/plat/nxp/s32/s32g/s32g2/include/platform_def.h
+++ b/plat/nxp/s32/s32g/s32g2/include/s32g2_platform_def.h
@@ -1,10 +1,10 @@
 /*
- * Copyright 2021 NXP
+ * Copyright 2021-2022 NXP
  *
  * SPDX-License-Identifier: BSD-3-Clause
  */
-#ifndef PLATFORM_DEF_H
-#define PLATFORM_DEF_H
+#ifndef S32G2_PLATFORM_DEF_H
+#define S32G2_PLATFORM_DEF_H
 
 #include <s32g_platform_def.h>
 
@@ -32,5 +32,5 @@
 #define FIRMWARE_WELCOME_STR_S32G_BL31	"This is S32G2 BL31\n"
 #endif
 
-#endif /* PLATFORM_DEF_H */
+#endif /* S32G2_PLATFORM_DEF_H */
 
diff --git a/plat/nxp/s32/s32g/s32g2/platform.mk b/plat/nxp/s32/s32g/s32g2/s32g2.mk
similarity index 89%
rename from plat/nxp/s32/s32g/s32g2/platform.mk
rename to plat/nxp/s32/s32g/s32g2/s32g2.mk
index 10ed4a49d..f1ee8e0ff 100644
--- a/plat/nxp/s32/s32g/s32g2/platform.mk
+++ b/plat/nxp/s32/s32g/s32g2/s32g2.mk
@@ -1,9 +1,11 @@
 #
-# Copyright 2019-2021 NXP
+# Copyright 2019-2022 NXP
 #
 # SPDX-License-Identifier: BSD-3-Clause
 #
 
+S32_PLAT_SOC := s32g2
+
 DDR_DRV_SRCS            += ${DDR_DRV}/s32g2/ddrc_cfg.c \
 			   ${DDR_DRV}/s32g2/dmem_cfg.c \
 			   ${DDR_DRV}/s32g2/dq_swap_cfg.c \
@@ -24,6 +26,3 @@ PLAT_BL_COMMON_SOURCES	+= drivers/nxp/s32/clk/s32g274a_clk.c \
 
 ERRATA_S32_050481	:= 1
 ERRATA_S32_050543     := 1
-
-# Device tree
-DTB_FILE_NAME		?= fsl-s32g274a-rdb.dtb
\ No newline at end of file
diff --git a/plat/nxp/s32/s32g/s32g2/s32g274ardb2/include/platform_def.h b/plat/nxp/s32/s32g/s32g2/s32g274ardb2/include/platform_def.h
new file mode 100644
index 000000000..8b2b095e0
--- /dev/null
+++ b/plat/nxp/s32/s32g/s32g2/s32g274ardb2/include/platform_def.h
@@ -0,0 +1,11 @@
+/*
+ * Copyright 2022 NXP
+ *
+ * SPDX-License-Identifier: BSD-3-Clause
+ */
+#ifndef PLATFORM_DEF_H
+#define PLATFORM_DEF_H
+
+#include <s32g2_platform_def.h>
+
+#endif /* PLATFORM_DEF_H */
diff --git a/plat/nxp/s32/s32g/s32g2/s32g274ardb2/platform.mk b/plat/nxp/s32/s32g/s32g2/s32g274ardb2/platform.mk
new file mode 100644
index 000000000..addf145f0
--- /dev/null
+++ b/plat/nxp/s32/s32g/s32g2/s32g274ardb2/platform.mk
@@ -0,0 +1,11 @@
+#
+# Copyright 2022 NXP
+#
+# SPDX-License-Identifier: BSD-3-Clause
+#
+
+include plat/nxp/s32/s32g/s32g2/s32g2.mk
+
+PLAT_INCLUDES		+= -Iplat/nxp/s32/s32g/s32g2/s32g274ardb2/include \
+
+DTB_FILE_NAME		?= fsl-s32g274a-rdb2.dtb
\ No newline at end of file
diff --git a/plat/nxp/s32/s32g/s32g2/s32g2xxaevb/include/platform_def.h b/plat/nxp/s32/s32g/s32g2/s32g2xxaevb/include/platform_def.h
new file mode 100644
index 000000000..8b2b095e0
--- /dev/null
+++ b/plat/nxp/s32/s32g/s32g2/s32g2xxaevb/include/platform_def.h
@@ -0,0 +1,11 @@
+/*
+ * Copyright 2022 NXP
+ *
+ * SPDX-License-Identifier: BSD-3-Clause
+ */
+#ifndef PLATFORM_DEF_H
+#define PLATFORM_DEF_H
+
+#include <s32g2_platform_def.h>
+
+#endif /* PLATFORM_DEF_H */
diff --git a/plat/nxp/s32/s32g/s32g2/s32g2xxaevb/platform.mk b/plat/nxp/s32/s32g/s32g2/s32g2xxaevb/platform.mk
new file mode 100644
index 000000000..d8cf828dd
--- /dev/null
+++ b/plat/nxp/s32/s32g/s32g2/s32g2xxaevb/platform.mk
@@ -0,0 +1,11 @@
+#
+# Copyright 2022 NXP
+#
+# SPDX-License-Identifier: BSD-3-Clause
+#
+
+include plat/nxp/s32/s32g/s32g2/s32g2.mk
+
+PLAT_INCLUDES		+= -Iplat/nxp/s32/s32g/s32g2/s32g2xxaevb/include \
+
+DTB_FILE_NAME		?= fsl-s32g2xxa-evb.dtb
\ No newline at end of file
-- 
2.17.1

