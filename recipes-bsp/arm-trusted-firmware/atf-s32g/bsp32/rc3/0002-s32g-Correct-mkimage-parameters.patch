From b87f8a3d2845d66a97974a0607ecd580aa25fd21 Mon Sep 17 00:00:00 2001
From: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Date: Thu, 6 Jan 2022 13:31:13 +0200
Subject: [PATCH 2/6] s32g: Correct mkimage parameters

Issue: ALB-8303
Upstream-Status: Pending 

Signed-off-by: Ghennadi Procopciuc <ghennadi.procopciuc@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 plat/nxp/s32/s32g/s32g_common.mk | 12 ++++++++----
 1 file changed, 8 insertions(+), 4 deletions(-)

diff --git a/plat/nxp/s32/s32g/s32g_common.mk b/plat/nxp/s32/s32g/s32g_common.mk
index 09f65453a..d75b204fd 100644
--- a/plat/nxp/s32/s32g/s32g_common.mk
+++ b/plat/nxp/s32/s32g/s32g_common.mk
@@ -1,5 +1,5 @@
 #
-# Copyright 2020-2021 NXP
+# Copyright 2020-2022 NXP
 #
 # SPDX-License-Identifier: BSD-3-Clause
 #
@@ -207,14 +207,18 @@ DTB_BASE		:= 0x34300000
 $(eval $(call add_define,DTB_BASE))
 BL2_BASE		:= 0x34302000
 $(eval $(call add_define,BL2_BASE))
+MKIMAGE_CFG ?= u-boot.cfgout
 
 all: call_mkimage
 call_mkimage: add_to_fip
 ifeq ($(MKIMAGE),)
-	$(eval MKIMAGE = $(shell dirname $(BL33))/tools/mkimage)
+	$(eval BL33DIR = $(shell dirname $(BL33)))
+	$(eval MKIMAGE = $(BL33DIR)/tools/mkimage)
 endif
-	@${MKIMAGE} -e ${BL2_BASE} -a ${DTB_BASE} -T s32gen1image \
-		-d ${BUILD_PLAT}/${FIP_NAME} ${BUILD_PLAT}/fip.s32
+	@cd ${BL33DIR} && \
+		${MKIMAGE} -e ${BL2_BASE} -a ${DTB_BASE} -T s32gen1image \
+		-n ${MKIMAGE_CFG} -d ${BUILD_PLAT}/${FIP_NAME} \
+		${BUILD_PLAT}/fip.s32
 	@echo "Generated ${BUILD_PLAT}/fip.s32 successfully"
 
 # Disable the PSCI platform compatibility layer
-- 
2.17.1

