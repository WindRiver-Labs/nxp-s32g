From 8cd153a3b78fdfe19674e35a918eccd70e4eba0b Mon Sep 17 00:00:00 2001
From: "Radu Pirea (NXP OSS)" <radu-nicolae.pirea@oss.nxp.com>
Date: Wed, 2 Feb 2022 14:45:37 +0200
Subject: [PATCH 33/64] serial: linflex: fix pending callback

Issue: ALB-8368

Upstream-Status: Pending 

Signed-off-by: Radu Pirea (NXP OSS) <radu-nicolae.pirea@oss.nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 drivers/serial/serial_linflexuart.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/drivers/serial/serial_linflexuart.c b/drivers/serial/serial_linflexuart.c
index b720737aab..ebfa7db951 100644
--- a/drivers/serial/serial_linflexuart.c
+++ b/drivers/serial/serial_linflexuart.c
@@ -173,9 +173,11 @@ static int linflex_serial_pending(struct udevice *dev, bool input)
 	uint32_t uartsr = __raw_readl(&priv->lfuart->uartsr);
 
 	if (input)
-		return ((uartsr & UARTSR_RFE) && (uartsr & UARTSR_RMB)) ? 1 : 0;
+		/* RX FIFO not empty. */
+		return !(uartsr & UARTSR_RFE);
 	else
-		return uartsr & UARTSR_DTF ? 0 : 1;
+		/* TX FIFO not full. */
+		return !(uartsr & UARTSR_DTF);
 }
 
 static int linflex_serial_probe(struct udevice *dev)
-- 
2.17.1

