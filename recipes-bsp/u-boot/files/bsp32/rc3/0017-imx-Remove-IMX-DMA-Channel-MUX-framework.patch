From df2e5e86717116da51e318dc8db048126810b496 Mon Sep 17 00:00:00 2001
From: Andrei Botila <andrei.botila@nxp.com>
Date: Sat, 15 Jan 2022 00:04:42 +0200
Subject: [PATCH 17/25] imx: Remove IMX DMA Channel MUX framework

Issue: ALB-8332
Upstream-Status: Pending 

Signed-off-by: Andrei Botila <andrei.botila@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 arch/arm/include/asm/mach-imx/dmachmux.h | 84 ------------------------
 arch/arm/mach-imx/dmachmux.c             | 75 ---------------------
 2 files changed, 159 deletions(-)
 delete mode 100644 arch/arm/include/asm/mach-imx/dmachmux.h
 delete mode 100644 arch/arm/mach-imx/dmachmux.c

diff --git a/arch/arm/include/asm/mach-imx/dmachmux.h b/arch/arm/include/asm/mach-imx/dmachmux.h
deleted file mode 100644
index d2aaa0c351..0000000000
--- a/arch/arm/include/asm/mach-imx/dmachmux.h
+++ /dev/null
@@ -1,84 +0,0 @@
-/* SPDX-License-Identifier: GPL-2.0+ */
-/*
- *
- * Copyright (C) 2014 Freescale Semiconductor, Inc.
- *
- * Author: Gilles Talis <gilles.talis@freescale.com>
- *
- * Based on iomux-v3.h
- *
- * This program is free software; you can redistribute it and/or
- * modify it under the terms of the GNU General Public License
- * as published by the Free Software Foundation; either version 2
- * of the License, or (at your option) any later version.
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- */
-
-#ifndef __MACH_DMACHMUX_H__
-#define __MACH_DMACHMUX_H__
-
-#include <common.h>
-
-/*
- *	Build DMAMUX structure
- *
- * This DMAMUX scheme allows configuring the DMA MUX components
- * by allocating a specific DMA request source to a specific DMA MUX channel
- *
- * - Each DMA MUX handles a number of channels
- * - Each channel has a configuration register (DMAMUX_CHCFG)
- *
- * DMAMUX/channel Bit field definitions
- *
- * DMAMUX_SHIFT:  0..3 (4 bits) - This is the DMAMUX (0-3)
- * DMAMUX_CHAN_SHIFT:	4..7 (4 bits) - This is DMAMUX channel (0-15)
- * DMACHANNEL_SRC_SHIFT:	16..21 (6 bits) - This is DMA Request source
- *						  number (0-63)
- * DMACH_ENABLE_SHIFT:	   22  (1 bit) - This enables/disables DMAMUX channel
- * DMACH_TRIG_SHIFT: 23 (1 bit) - This enables/disables periodic
- *				  trigger capability
- */
-
-#define DMAMUX_SHIFT			0
-#define DMAMUX_MASK				(0x0f << DMAMUX_SHIFT)
-#define DMAMUX_CHAN_SHIFT		4
-#define DMAMUX_CHAN_MASK		(0x0f << DMAMUX_CHAN_SHIFT)
-#define DMACH_SRC_SHIFT			16
-#define DMACH_SRC_MASK			(0x3f << DMACH_SRC_SHIFT)
-#define DMACH_ENABLE_SHIFT		22
-#define DMACH_ENABLE_MASK		(0x1 << DMACH_ENABLE_SHIFT)
-#define DMACH_TRIG_SHIFT		23
-#define DMACH_TRIG_MASK			(0x1 << DMACH_TRIG_SHIFT)
-
-#define DMAMUX_CHANNEL_ENABLE		1
-#define DMAMUX_CHANNEL_DISABLE		0
-#define DMAMUX_CHANNEL_TRIG_ON		1
-#define DMAMUX_CHANNEL_TRIG_OFF		0
-
-#define DMAMUX_CHANNEL_NUMBER	16
-
-#define DMAMUX_CHANNEL(dma_mux, channel, src, trigger, enable)	\
-	((dma_mux		<< DMAMUX_SHIFT)	|	\
-	(channel		<< DMAMUX_CHAN_SHIFT)	|	\
-	(src			<< DMACH_SRC_SHIFT)		|	\
-	(trigger		<< DMACH_TRIG_SHIFT)		|	\
-	(enable			<< DMACH_ENABLE_SHIFT))
-
-enum {
-	DMAMUX_0,
-	DMAMUX_1,
-	DMAMUX_2,
-	DMAMUX_3,
-	DMAMUX_MAX,
-};
-
-typedef u32 dmamux_cfg_t;
-
-int imx_dmamux_setup_channel(dmamux_cfg_t channel);
-int imx_dmamux_setup_multiple_channels(dmamux_cfg_t const *channel_list,
-				       unsigned int count);
-
-#endif
diff --git a/arch/arm/mach-imx/dmachmux.c b/arch/arm/mach-imx/dmachmux.c
deleted file mode 100644
index f7ab3af0ee..0000000000
--- a/arch/arm/mach-imx/dmachmux.c
+++ /dev/null
@@ -1,75 +0,0 @@
-// SPDX-License-Identifier: GPL-2.0+
-/*
- *
- * Copyright (C) 2014 Freescale Semiconductor, Inc.
- *
- * Author: Gilles Talis <gilles.talis@freescale.com>
- *
- * Based on iomux-v3.c
- *
- * This program is free software; you can redistribute it and/or
- * modify it under the terms of the GNU General Public License
- * as published by the Free Software Foundation; either version 2
- * of the License, or (at your option) any later version.
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- */
-#include <common.h>
-#include <asm/io.h>
-#include <asm/arch/imx-regs.h>
-#include <asm/imx-common/dmachmux.h>
-
-static void *dmamux_base[] = {
-		(void *)DMA_MUX0_BASE_ADDR,
-#if !defined(CONFIG_LAST_DMA_MUX_IS_0)
-		(void *)DMA_MUX1_BASE_ADDR,
-		(void *)DMA_MUX2_BASE_ADDR,
-		(void *)DMA_MUX3_BASE_ADDR,
-#endif
-};
-
-/*
- * configures a single channel in one of the DMA channel muxes
- */
-int imx_dmamux_setup_channel(dmamux_cfg_t channel)
-{
-	void __iomem *base;
-
-	u8 dmamux = (u8)((channel & DMAMUX_MASK) >> DMAMUX_SHIFT);
-	u8 dmamux_ch = (u8)((channel & DMAMUX_CHAN_MASK) >> DMAMUX_CHAN_SHIFT);
-	u8 dmach_conf = (u8)(channel >> 16);
-
-	if (dmamux >= DMAMUX_MAX)
-		return -1;
-
-	if (dmamux_ch > DMAMUX_CHANNEL_NUMBER)
-		return -1;
-
-	base = dmamux_base[dmamux];
-
-	__raw_writeb(dmach_conf, base + dmamux_ch);
-
-	return 0;
-}
-
-/*
- * configures multiple channels in any of the DMA muxes
- */
-int imx_dmamux_setup_multiple_channels(dmamux_cfg_t const *channel_list,
-				       unsigned int count)
-{
-	dmamux_cfg_t const *p = channel_list;
-	int i;
-	int ret;
-
-	for (i = 0; i < count; i++) {
-		ret = imx_dmamux_setup_channel(*p);
-		if (ret)
-			return ret;
-		p++;
-	}
-	return 0;
-}
-
-- 
2.17.1

