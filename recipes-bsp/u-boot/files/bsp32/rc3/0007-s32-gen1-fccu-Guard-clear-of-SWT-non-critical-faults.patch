From 494ce4844b290e9c77b72bb8e2cee74f61a40a9c Mon Sep 17 00:00:00 2001
From: Ciprian Costea <ciprianmarian.costea@nxp.com>
Date: Thu, 13 Jan 2022 10:15:35 +0200
Subject: [PATCH 07/25] s32-gen1: fccu: Guard clear of SWT non-critical faults
 for non-atf boot flow

Issue: ALB-8341
Upstream-Status: Pending 

Signed-off-by: Ciprian Costea <ciprianmarian.costea@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 arch/arm/cpu/armv8/s32/s32-gen1/soc.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/arch/arm/cpu/armv8/s32/s32-gen1/soc.c b/arch/arm/cpu/armv8/s32/s32-gen1/soc.c
index 233047a135..448d5e8f6b 100644
--- a/arch/arm/cpu/armv8/s32/s32-gen1/soc.c
+++ b/arch/arm/cpu/armv8/s32/s32-gen1/soc.c
@@ -34,9 +34,11 @@
 #include <s32gen1_clk_utils.h>
 
 /* FCCU registers */
+#ifndef CONFIG_S32_ATF_BOOT_FLOW
 #define FCCU_NCF_S1	(FCCU_BASE_ADDR + 0x84)
 #define FCCU_NCFK	(FCCU_BASE_ADDR + 0x90)
 #define FCCU_NCFK_KEY	(0xAB3498FE)
+#endif
 
 DECLARE_GLOBAL_DATA_PTR;
 
@@ -286,6 +288,7 @@ U_BOOT_CMD(
  * Clear non-critical faults generated by SWT (software watchdog timer)
  * All SWT faults are placed in NCF_S1 (33-38)
  */
+#ifndef CONFIG_S32_ATF_BOOT_FLOW
 static void clear_swt_faults(void)
 {
 	u32 val = readl(FCCU_NCF_S1);
@@ -295,6 +298,7 @@ static void clear_swt_faults(void)
 		writel(val, FCCU_NCF_S1);
 	}
 }
+#endif
 
 #ifdef CONFIG_SAF1508BET_USB_PHY
 static int enable_saf1508bet(void)
@@ -342,7 +346,9 @@ static int enable_saf1508bet(void)
 
 int arch_misc_init(void)
 {
+#ifndef CONFIG_S32_ATF_BOOT_FLOW
 	clear_swt_faults();
+#endif
 
 #ifdef CONFIG_SAF1508BET_USB_PHY
 	/* The usb phy must be probed in u-boot in order to have a working USB
-- 
2.17.1

