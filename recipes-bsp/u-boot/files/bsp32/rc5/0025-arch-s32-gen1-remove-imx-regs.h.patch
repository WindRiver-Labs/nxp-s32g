From 61df9b5a6eaca23c0d5e77d9881a100eee3d3cbc Mon Sep 17 00:00:00 2001
From: "Radu Pirea (NXP OSS)" <radu-nicolae.pirea@oss.nxp.com>
Date: Thu, 10 Feb 2022 12:12:26 +0200
Subject: [PATCH 25/43] arch: s32-gen1: remove imx-regs.h

Issue: ALB-4149

Upstream-Status: Pending 

Signed-off-by: Radu Pirea (NXP OSS) <radu-nicolae.pirea@oss.nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 arch/arm/include/asm/arch-s32/imx-regs.h | 54 ------------------------
 drivers/i2c/mxc_i2c.c                    |  4 +-
 drivers/serial/serial_linflexuart.c      | 23 +++++++++-
 drivers/usb/host/ehci-mx6.c              |  4 +-
 include/configs/s32.h                    |  4 ++
 5 files changed, 32 insertions(+), 57 deletions(-)
 delete mode 100644 arch/arm/include/asm/arch-s32/imx-regs.h

diff --git a/arch/arm/include/asm/arch-s32/imx-regs.h b/arch/arm/include/asm/arch-s32/imx-regs.h
deleted file mode 100644
index d4ea7c3c2f..0000000000
--- a/arch/arm/include/asm/arch-s32/imx-regs.h
+++ /dev/null
@@ -1,54 +0,0 @@
-/* SPDX-License-Identifier:     GPL-2.0+ */
-/*
- * (C) Copyright 2013-2016 Freescale Semiconductor, Inc.
- * Copyright 2017-2021 NXP
- */
-
-#ifndef __ASM_ARCH_IMX_REGS_H__
-#define __ASM_ARCH_IMX_REGS_H__
-#include <config.h>
-
-#define ARCH_MXC
-
-#include "s32-gen1/s32-gen1-regs.h"
-
-/* TODO Remove this after the IOMUX framework is implemented */
-#define IOMUXC_BASE_ADDR SIUL2_BASE_ADDR
-
-/* MUX mode and PAD ctrl are in one register */
-#define CONFIG_IOMUX_SHARE_CONF_REG
-
-#define I2C_QUIRK_REG
-
-#if !(defined(__KERNEL_STRICT_NAMES) || defined(__ASSEMBLY__))
-#include <asm/types.h>
-
-/* UART */
-struct linflex_fsl {
-	u32 lincr1;
-	u32 linier;
-	u32 linsr;
-	u32 linesr;
-	u32 uartcr;
-	u32 uartsr;
-	u32 lintcsr;
-	u32 linocr;
-	u32 lintocr;
-	u32 linfbrr;
-	u32 linibrr;
-	u32 lincfr;
-	u32 lincr2;
-	u32 bidr;
-	u32 bdrl;
-	u32 bdrm;
-	u32 reserved[3];
-	u32 gcr;
-	u32 uartpto;
-	u32 uartcto;
-	u32 dmatxe;
-	u32 dmarxe;
-};
-
-#endif	/* __ASSEMBLER__*/
-
-#endif	/* __ASM_ARCH_IMX_REGS_H__ */
diff --git a/drivers/i2c/mxc_i2c.c b/drivers/i2c/mxc_i2c.c
index e185df1467..b81c728515 100644
--- a/drivers/i2c/mxc_i2c.c
+++ b/drivers/i2c/mxc_i2c.c
@@ -10,13 +10,15 @@
  *  Copyright (C) 2005 Matthias Blaschke <blaschke at synertronixx.de>
  *  Copyright (C) 2007 RightHand Technologies, Inc.
  *  Copyright (C) 2008 Darius Augulis <darius.augulis at teltonika.lt>
- *  Copyright 2020-2021 NXP
+ *  Copyright 2020-2022 NXP
  *
  */
 
 #include <common.h>
 #include <asm/arch/clock.h>
+#if defined(CONFIG_MACH_IMX)
 #include <asm/arch/imx-regs.h>
+#endif
 #include <dm/device_compat.h>
 #include <linux/errno.h>
 #include <asm/mach-imx/mxc_i2c.h>
diff --git a/drivers/serial/serial_linflexuart.c b/drivers/serial/serial_linflexuart.c
index 567d3d2675..f4867d0ff8 100644
--- a/drivers/serial/serial_linflexuart.c
+++ b/drivers/serial/serial_linflexuart.c
@@ -11,7 +11,6 @@
 #include <asm/io.h>
 #include <serial.h>
 #include <linux/compiler.h>
-#include <asm/arch/imx-regs.h>
 #include <clk.h>
 
 #define LINCR1_INIT			BIT(0)
@@ -42,6 +41,28 @@
 
 DECLARE_GLOBAL_DATA_PTR;
 
+struct linflex_fsl {
+	u32 lincr1;
+	u32 linier;
+	u32 linsr;
+	u32 linesr;
+	u32 uartcr;
+	u32 uartsr;
+	u32 lintcsr;
+	u32 linocr;
+	u32 lintocr;
+	u32 linfbrr;
+	u32 linibrr;
+	u32 lincfr;
+	u32 lincr2;
+	u32 bidr;
+	u32 bdrl;
+	u32 bdrm;
+	u32 reserved[3];
+	u32 gcr;
+	u32 uartpto;
+};
+
 static u32 linflex_ldiv_multiplier(struct linflex_fsl *base)
 {
 #ifdef CONFIG_TARGET_TYPE_S32GEN1_EMULATOR
diff --git a/drivers/usb/host/ehci-mx6.c b/drivers/usb/host/ehci-mx6.c
index e4baac8666..da31c12e9a 100644
--- a/drivers/usb/host/ehci-mx6.c
+++ b/drivers/usb/host/ehci-mx6.c
@@ -2,7 +2,7 @@
 /*
  * Copyright (c) 2009 Daniel Mack <daniel@caiaq.de>
  * Copyright (C) 2010 Freescale Semiconductor, Inc.
- * Copyright 2020-2021 NXP
+ * Copyright 2020-2022 NXP
  */
 
 #include <common.h>
@@ -12,7 +12,9 @@
 #include <linux/compiler.h>
 #include <usb/ehci-ci.h>
 #include <asm/io.h>
+#if defined(CONFIG_MACH_IMX)
 #include <asm/arch/imx-regs.h>
+#endif
 #include <asm/arch/clock.h>
 #include <asm/mach-imx/iomux-v3.h>
 #include <asm/mach-imx/sys_proto.h>
diff --git a/include/configs/s32.h b/include/configs/s32.h
index 12a03221b1..522712a1d1 100644
--- a/include/configs/s32.h
+++ b/include/configs/s32.h
@@ -458,6 +458,10 @@
 #define FLASH_SECTOR_SIZE		0x40000 /* 256 KB */
 #endif
 
+#ifdef CONFIG_SYS_I2C_MXC
+#define I2C_QUIRK_REG
+#endif
+
 #if defined(CONFIG_QSPI_BOOT)
 #define CONFIG_SYS_MAX_FLASH_BANKS	1
 #define CONFIG_SYS_MAX_FLASH_SECT 	(0x4000000 / CONFIG_ENV_SECT_SIZE)
-- 
2.17.1

