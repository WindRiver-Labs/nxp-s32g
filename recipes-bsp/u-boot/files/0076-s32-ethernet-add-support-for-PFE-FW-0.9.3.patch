From 7a0fcf41bb9743d54528133fb50dabe8596ee2c8 Mon Sep 17 00:00:00 2001
From: Ondrej Spacek <ondrej.spacek@nxp.com>
Date: Fri, 5 Feb 2021 13:40:34 +0100
Subject: [PATCH 76/76] s32: ethernet: add support for PFE FW 0.9.3

Issue: ALB-6445

Signed-off-by: Ondrej Spacek <ondrej.spacek@nxp.com>
---
 drivers/net/pfeng/Makefile        |  6 +++---
 drivers/net/pfeng/hw_abi/pfe_ct.h | 18 +++++++-----------
 2 files changed, 10 insertions(+), 14 deletions(-)

diff --git a/drivers/net/pfeng/Makefile b/drivers/net/pfeng/Makefile
index 00929deb09..7c5533915f 100644
--- a/drivers/net/pfeng/Makefile
+++ b/drivers/net/pfeng/Makefile
@@ -1,6 +1,6 @@
 # SPDX-License-Identifier:GPL-2.0
 #
-# Copyright 2019-2020 NXP
+# Copyright 2019-2021 NXP
 #
 
 # S32G PFEng driver
@@ -18,8 +18,8 @@ INCLUDES += -I$(INC_PREFIX)pfe_platform/public
 
 CCFLAGS_pfe += -D$(PFE_CFG_TARGET_ARCH_DEF) -D$(PFE_CFG_TARGET_OS_DEF) -D$(PFE_CFG_BUILD_PROFILE_DEF)
 
-# FW abi version
-ccflags-y += -DPFE_CFG_PFE_CT_H_MD5=bf8e8abc66429d158e51b80d3e25ad46
+# Hash of compatible FW binary interface (0.9.3)
+ccflags-y += -DPFE_CFG_PFE_CT_H_MD5=4e3e2e8a5e0e8e215c15a424048782d9
 # Platform
 ccflags-y += -DPFE_CFG_TARGET_ARCH_aarch64
 # IP version
diff --git a/drivers/net/pfeng/hw_abi/pfe_ct.h b/drivers/net/pfeng/hw_abi/pfe_ct.h
index 92b4e0cb5e..3f4edab242 100644
--- a/drivers/net/pfeng/hw_abi/pfe_ct.h
+++ b/drivers/net/pfeng/hw_abi/pfe_ct.h
@@ -1,7 +1,7 @@
 /* SPDX-License-Identifier: GPL 2.0 */
 /*
  *  Copyright (c) 2020 Imagination Technologies Limited
- *  Copyright 2018-2020 NXP
+ *  Copyright 2018-2021 NXP
  */
 
 /**
@@ -62,8 +62,6 @@ struct pfe_ct_log_if {
 	u32 class_stats[4] __aligned(4);
 } __packed __aligned(4);
 
-_ct_assert(sizeof(struct pfe_ct_log_if) == 108);
-
 /**
  * @brief Firmware physical interface
  */
@@ -77,12 +75,10 @@ struct pfe_ct_phy_if {
 	u8 mirror;
 	u8 reserved[3];
 	u32 spd;
+	u32 reserved1;
 	u32 phy_stats[4] __aligned(4);
 } __packed __aligned(4);
 
-_ct_assert(sizeof(struct pfe_ct_phy_if) == 36);
-
-
 /**
  * @brief Firmware version information
  */
@@ -103,11 +99,9 @@ struct pfe_ct_version {
 	char vctrl[16];
 	/*  This header version */
 	char cthdr[36];
+	u32 res1[2];
 } __packed;
 
-_ct_assert(sizeof(struct pfe_ct_version) == 96);
-
-
 /**
  * @brief PE memory map representation type shared between host and PFE
  */
@@ -128,7 +122,8 @@ struct pfe_ct_pe_mmap {
 	u8 fill2[28];
 } __packed __aligned(4);
 
-_ct_assert(sizeof(struct pfe_ct_pe_mmap) == 168);
+/* Structure length has to be compatible with FW binary (currently 176)*/
+_ct_assert(sizeof(struct pfe_ct_pe_mmap) == 176);
 
 /**
  * @brief	HIF RX packet header
@@ -149,6 +144,7 @@ struct pfe_ct_hif_rx_hdr {
 	u32 rx_timestamp_s;
 } __packed;
 
+/* Structure has to be 16B in length for correct decoding of rx data */
 _ct_assert(sizeof(struct pfe_ct_hif_rx_hdr) == 16);
 
 /**
@@ -165,7 +161,7 @@ struct pfe_ct_hif_tx_hdr {
 	u32 cookie;
 } __aligned(4);
 
+/* Structure has to be 16B in length for correct HW functionality */
 _ct_assert(sizeof(struct pfe_ct_hif_tx_hdr) == 16);
-_ct_assert(0 == (sizeof(struct pfe_ct_hif_tx_hdr) % sizeof(uint32_t)));
 #endif /* HW_S32G_PFE_CT_H_ */
 /** @} */
-- 
2.17.1

