From 35f25b10d4413742a2be3a1840a67ad996d3c436 Mon Sep 17 00:00:00 2001
From: Larisa Grigore <larisa.grigore@nxp.com>
Date: Mon, 29 Mar 2021 16:19:08 +0300
Subject: [PATCH 26/42] s32g: Activate periph clocks for s32g emulator

This reverts d45c94a6172 "s32g_emu: Remove periph
clock initialization".

Upstream-Status: Pending

Issue: ALB-6496
Signed-off-by: Larisa Grigore <larisa.grigore@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 arch/arm/cpu/armv8/s32/cpu.c | 4 ----
 drivers/mmc/fsl_esdhc_imx.c  | 3 +--
 2 files changed, 1 insertion(+), 6 deletions(-)

diff --git a/arch/arm/cpu/armv8/s32/cpu.c b/arch/arm/cpu/armv8/s32/cpu.c
index 9d9a3427d3..c589f34724 100644
--- a/arch/arm/cpu/armv8/s32/cpu.c
+++ b/arch/arm/cpu/armv8/s32/cpu.c
@@ -276,7 +276,6 @@ static inline void final_mmu_setup(void)
 }
 
 #if defined(CONFIG_S32_GEN1) && !defined(CONFIG_S32_ATF_BOOT_FLOW)
-#ifndef CONFIG_TARGET_TYPE_S32GEN1_EMULATOR
 /*
  * This function is a temporary fix for drivers without clock bindings.
  *
@@ -313,7 +312,6 @@ static int enable_periph_clocks(void)
 	return 0;
 }
 #endif
-#endif
 
 #if defined(CONFIG_S32_SKIP_RELOC) && !defined(CONFIG_S32_ATF_BOOT_FLOW)
 static inline int clear_after_bss(void)
@@ -503,9 +501,7 @@ int arch_early_init_r(void)
 #endif
 
 #if defined(CONFIG_S32_GEN1) && !defined(CONFIG_S32_ATF_BOOT_FLOW)
-#ifndef CONFIG_TARGET_TYPE_S32GEN1_EMULATOR
 	return enable_periph_clocks();
-#endif
 #endif
 
 	return rv;
diff --git a/drivers/mmc/fsl_esdhc_imx.c b/drivers/mmc/fsl_esdhc_imx.c
index 7779e0d22a..0007daea73 100644
--- a/drivers/mmc/fsl_esdhc_imx.c
+++ b/drivers/mmc/fsl_esdhc_imx.c
@@ -1618,9 +1618,8 @@ static int fsl_esdhc_probe(struct udevice *dev)
 
 	init_clk_usdhc(dev->seq);
 
-#ifdef CONFIG_TARGET_TYPE_S32GEN1_EMULATOR
+#if CONFIG_IS_ENABLED(CLK)
 	priv->sdhc_clk = 400000000;
-#elif CONFIG_IS_ENABLED(CLK)
 	/* Assigned clock already set clock */
 	ret = clk_get_by_name(dev, "per", &priv->per_clk);
 	if (ret) {
-- 
2.25.1

