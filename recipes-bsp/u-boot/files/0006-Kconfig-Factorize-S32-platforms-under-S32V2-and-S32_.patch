From f43c6dbad8e35992292a454f4044a900dfe918bf Mon Sep 17 00:00:00 2001
From: Ghennadi Procopciuc <Ghennadi.Procopciuc@nxp.com>
Date: Thu, 26 Nov 2020 13:11:44 +0200
Subject: [PATCH 06/76] Kconfig: Factorize S32 platforms under S32V2 and
 S32_GEN1

Issue: ALB-5304
Signed-off-by: Ghennadi Procopciuc <Ghennadi.Procopciuc@nxp.com>
---
 arch/arm/cpu/armv8/s32/Kconfig      |  15 ++++
 board/freescale/Kconfig             | 104 ++++++++++++++++------------
 board/freescale/s32-gen1/Kconfig    |  38 ++++------
 board/freescale/s32v234ccpb/Kconfig |  14 ----
 board/freescale/s32v234evb/Kconfig  |  23 ------
 board/freescale/s32v234pcie/Kconfig |  14 ----
 6 files changed, 87 insertions(+), 121 deletions(-)

diff --git a/arch/arm/cpu/armv8/s32/Kconfig b/arch/arm/cpu/armv8/s32/Kconfig
index df71c8ef8a..6e9eb5bcb3 100644
--- a/arch/arm/cpu/armv8/s32/Kconfig
+++ b/arch/arm/cpu/armv8/s32/Kconfig
@@ -17,61 +17,76 @@ choice
 config TARGET_S32V234CCPB
 	bool "Support s32v234ccpb"
 	select S32V234CCPB
+	select S32V2
 
 config TARGET_S32V234EVB
 	bool "Support s32v234evb"
 	select SYS_FSL_ERRATUM_ESDHC111
+	select S32V2
 	help
 	  S32V Evaluation System for high-performance, safe computation-intensive
 	  front vision, surround vision and sensor fusion applications.
 
 config TARGET_S32V234PCIE
 	bool "Support s32v234pcie"
+	select S32V2
 	help
 	  S32V234 board with PCIe Edge connector.
 
 config TARGET_MPXS32V234
 	bool "Support s32v234sbc"
 	select S32V234EVB_29288
+	select S32V2
 
 config TARGET_CAMPPS32V2
 	bool "Support campps32v2"
+	select S32V2
 	help
 	  Enable Camera card V2 target.
 	  Camera card V2 is a developemnt board with 6x S32V.
 
 config TARGET_S32V344EVB
 	bool "Support s32v344evb"
+	select S32_GEN1
 
 config TARGET_S32V344SIM
 	bool "Support s32v344 VDK"
+	select S32_GEN1
 
 config TARGET_S32R45EVB
 	bool "Support s32r45evb"
+	select S32_GEN1
 
 config TARGET_S32R45SIM
 	bool "Support s32r45 VDK"
+	select S32_GEN1
 
 config TARGET_S32R45EMU
 	bool "Support s32r45 ZeBu"
+	select S32_GEN1
 
 config TARGET_S32G274AEVB
 	bool "Support s32g274aevb"
+	select S32_GEN1
 
 config TARGET_S32G274ARDB
 	bool "Support s32g274ardb"
+	select S32_GEN1
 
 config TARGET_S32G274ABLUEBOX3
 	bool "Support s32g274abluebox3"
+	select S32_GEN1
 	help
 	  Enable Microsys S32G SoM Bluebox 3 target.
 	  S32G works as PCIE EP.
 
 config TARGET_S32G274ASIM
 	bool "Support s32g274a VDK"
+	select S32_GEN1
 
 config TARGET_S32G274AEMU
 	bool "Support s32g274a ZeBu"
+	select S32_GEN1
 
 endchoice
 
diff --git a/board/freescale/Kconfig b/board/freescale/Kconfig
index 7c4aa0d603..0bc9b343d1 100644
--- a/board/freescale/Kconfig
+++ b/board/freescale/Kconfig
@@ -1,67 +1,83 @@
-if TARGET_S32V234EVB ||		\
-   TARGET_S32V234PCIE ||	\
-   TARGET_S32V234CCPB ||	\
-   TARGET_CAMPPS32V2 ||		\
-   TARGET_S32V344EVB ||		\
-   TARGET_S32V344SIM ||		\
-   TARGET_S32G274AEVB ||	\
-   TARGET_S32G274ABLUEBOX3 ||	\
-   TARGET_S32G274ARDB ||	\
-   TARGET_S32G274ASIM || 	\
-   TARGET_S32G274AEMU ||	\
-   TARGET_S32R45EVB ||		\
-   TARGET_S32R45SIM ||		\
-   TARGET_S32R45EMU
+config S32V2
+	bool
+	default false
 
-source "board/freescale/s32v234evb/Kconfig"
+config S32_GEN1
+	bool "S32 GEN1 Common Chassis"
+	select CLK
+	select CLK_SCMI
+	select OF_SEPARATE
+	select SCMI_FIRMWARE
+	help
+	  Platform Selection
 
-source "board/freescale/s32v234pcie/Kconfig"
+if S32V2 || S32_GEN1
 
-source "board/freescale/s32v234ccpb/Kconfig"
+config EXTRA_KERNEL_BOOT_ARGS
+	string "Additional boot arguments for Linux kernel"
+	default ""
 
-source "board/freescale/campps32v2/Kconfig"
+config PHY_RGMII_DIRECT_CONNECTED
+	bool "Enable fixed PHY for MDIO Bus/PHY emulation with fixed speed/link PHYs"
+	default n
+	help
+	  Adds the platform "fixed" MDIO Bus to cover the boards that
+	  use PHYs that are not connected to the real MDIO bus.
 
-source "board/freescale/s32-gen1/Kconfig"
+config S32_SKIP_RELOC
+	bool "Skip code relocation on NXP S32 platforms"
+	help
+		This allows to run U-Boot in SRAM, without touching the DDR
+		memory. It's very useful for bring-up activities or when the DDR
+		memory is not stable.
 
+if !TARGET_MPXS32V234
 config SYS_VENDOR
 	string
 	default "freescale"
+endif
+
+config XEN_SUPPORT
+	bool "Enable Xen EL2 Booting and set environment variables in order to boot directly into Xen Hypervisor"
+	default n
+	help
+	  Skip the enablement of CONFIG_ARMV8_SWITCH_TO_EL1 and set Xen Image,
+	  fdts load addresses and u-boot environment variables in order for u-boot
+	  to directly load the Xen Image which will use a given Kernel Image as
+	  Dom0.
+
+endif
+
+if S32V2
+source "board/freescale/s32v234evb/Kconfig"
+
+source "board/freescale/s32v234pcie/Kconfig"
+
+source "board/freescale/s32v234ccpb/Kconfig"
+
+source "board/freescale/campps32v2/Kconfig"
 
 config SYS_DATA_BASE
 	hex "Data Base"
-	default 0x3E800000 if TARGET_S32V234EVB || TARGET_S32V234PCIE || \
-	                      TARGET_S32V234CCPB || TARGET_CAMPPS32V2
-	default 0x34000000 if TARGET_S32V344EVB || TARGET_S32G274AEVB || \
-			      TARGET_S32G274ARDB || \
-			      TARGET_S32G274ABLUEBOX3 || \
-			      TARGET_S32R45EVB || \
-			      TARGET_TYPE_S32GEN1_EMULATOR || \
-	                      TARGET_TYPE_S32GEN1_SIMULATOR
+	default 0x3E800000
 	help
 	  U-boot data base address (normally SRAM base address)
 
 config SYS_MEM_SIZE
 	hex "RAM Memory Size"
-	default 0x00400000 if TARGET_S32V234EVB || TARGET_S32V234PCIE || \
-	                      TARGET_S32V234CCPB  || TARGET_CAMPPS32V2
-	default 0x00800000 if TARGET_S32V344EVB || TARGET_S32G274AEVB || \
-			      TARGET_S32G274ARDB || \
-			      TARGET_S32G274ABLUEBOX3 || \
-			      TARGET_S32R45EVB || \
-			      TARGET_TYPE_S32GEN1_EMULATOR || \
-	                      TARGET_TYPE_S32GEN1_SIMULATOR
+	default 0x00400000
 	help
 	  U-boot SRAM size (8 MB for Gen1, 4 MB for older architectures)
 
-config EXTRA_KERNEL_BOOT_ARGS
-	string "Additional boot arguments for Linux kernel"
-	default ""
-
-config S32_SKIP_RELOC
-	bool "Skip code relocation on NXP S32 platforms"
+config S32V234_FAST_BOOT
+	bool "Configure DCD and RUNMODE for a fast-boot efused board"
+	default n
 	help
-		This allows to run U-Boot in SRAM, without touching the DDR
-		memory. It's very useful for bring-up activities or when the DDR
-		memory is not stable.
+	  Configure DCD and RUNMODE for a board that has been efused such that
+	  OCOTP_CFG6:[19]FAST_BOOT_ENABLE = 0 and OCOTP_CFG6:[18]NO_PLL = 1.
 
 endif
+
+if S32_GEN1
+source "board/freescale/s32-gen1/Kconfig"
+endif
diff --git a/board/freescale/s32-gen1/Kconfig b/board/freescale/s32-gen1/Kconfig
index c42c5613af..755a73feef 100644
--- a/board/freescale/s32-gen1/Kconfig
+++ b/board/freescale/s32-gen1/Kconfig
@@ -1,3 +1,15 @@
+config SYS_DATA_BASE
+	hex "Data Base"
+	default 0x34000000
+	help
+	  U-boot data base address (normally SRAM base address)
+
+config SYS_MEM_SIZE
+	hex "RAM Memory Size"
+	default 0x00800000
+	help
+	  U-boot SRAM size (8 MB for Gen1, 4 MB for older architectures)
+
 if TARGET_S32G274AEMU || TARGET_S32R45EMU
 
 config TARGET_TYPE_S32GEN1_EMULATOR
@@ -23,16 +35,6 @@ if TARGET_S32V344EVB || TARGET_S32G274AEVB || TARGET_S32G274ARDB || \
 	TARGET_TYPE_S32GEN1_EMULATOR || \
 	TARGET_TYPE_S32GEN1_SIMULATOR
 
-config S32_GEN1
-	bool "S32 GEN1 Common Chassis"
-	default y
-	select CLK
-	select CLK_SCMI
-	select OF_SEPARATE
-	select SCMI_FIRMWARE
-	help
-	  Platform Selection
-
 config SYS_BOARD
 	string
 	default "s32-gen1"
@@ -71,22 +73,6 @@ config DTB_SRAM_ADDR
 	hex "SRAM address at which the dtb will be found"
 	default 0x34090000
 
-config PHY_RGMII_DIRECT_CONNECTED
-	bool "Enable fixed PHY for MDIO Bus/PHY emulation with fixed speed/link PHYs"
-	default n
-	help
-	  Adds the platform "fixed" MDIO Bus to cover the boards that
-	  use PHYs that are not connected to the real MDIO bus.
-
-config XEN_SUPPORT
-	bool "Enable Xen EL2 Booting and set environment variables in order to boot directly into Xen Hypervisor"
-	default n
-	help
-	  Skip the enablement of CONFIG_ARMV8_SWITCH_TO_EL1 and set Xen Image,
-	  fdts load addresses and u-boot environment variables in order for u-boot
-	  to directly load the Xen Image which will use a given Kernel Image as
-	  Dom0.
-
 choice
 	prompt "Select boot flow configuration"
 	default S32_STANDALONE_BOOT_FLOW
diff --git a/board/freescale/s32v234ccpb/Kconfig b/board/freescale/s32v234ccpb/Kconfig
index 674df95692..ef63a1e1e5 100644
--- a/board/freescale/s32v234ccpb/Kconfig
+++ b/board/freescale/s32v234ccpb/Kconfig
@@ -8,18 +8,4 @@ config SYS_CONFIG_NAME
 	string
 	default "s32v234ccpb"
 
-config PHY_RGMII_DIRECT_CONNECTED
-	bool "Enable fixed PHY for MDIO Bus/PHY emulation with fixed speed/link PHYs"
-	default n
-	help
-	  Adds the platform "fixed" MDIO Bus to cover the boards that
-	  use PHYs that are not connected to the real MDIO bus.
-
-config S32V234_FAST_BOOT
-	bool "Configure DCD and RUNMODE for a fast-boot efused board"
-	default n
-	help
-	  Configure DCD and RUNMODE for a board that has been efused such that
-	  OCOTP_CFG6:[19]FAST_BOOT_ENABLE = 0 and OCOTP_CFG6:[18]NO_PLL = 1.
-
 endif
diff --git a/board/freescale/s32v234evb/Kconfig b/board/freescale/s32v234evb/Kconfig
index 00d9bcfa2b..71952b46eb 100644
--- a/board/freescale/s32v234evb/Kconfig
+++ b/board/freescale/s32v234evb/Kconfig
@@ -10,27 +10,4 @@ config SYS_CONFIG_NAME
 	default "s32v234evb29288" if S32V234EVB_29288
 	default "s32v234evb28899" if S32V234EVB_28899
 
-config PHY_RGMII_DIRECT_CONNECTED
-	bool "Enable fixed PHY for MDIO Bus/PHY emulation with fixed speed/link PHYs"
-	default n
-	help
-	  Adds the platform "fixed" MDIO Bus to cover the boards that
-	  use PHYs that are not connected to the real MDIO bus.
-
-config S32V234_FAST_BOOT
-	bool "Configure DCD and RUNMODE for a fast-boot efused board"
-	default n
-	help
-	  Configure DCD and RUNMODE for a board that has been efused such that
-	  OCOTP_CFG6:[19]FAST_BOOT_ENABLE = 0 and OCOTP_CFG6:[18]NO_PLL = 1.
-
-config XEN_SUPPORT
-	bool "Enable Xen EL2 Booting and set environment variables in order to boot directly into Xen Hypervisor"
-	default n
-	help
-	  Skip the enablement of CONFIG_ARMV8_SWITCH_TO_EL1 and set Xen Image,
-	  fdts load addresses and u-boot environment variables in order for u-boot
-	  to directly load the Xen Image which will use a given Kernel Image as 
-	  Dom0.
-
 endif
diff --git a/board/freescale/s32v234pcie/Kconfig b/board/freescale/s32v234pcie/Kconfig
index dc2f57312b..e615e54aaf 100644
--- a/board/freescale/s32v234pcie/Kconfig
+++ b/board/freescale/s32v234pcie/Kconfig
@@ -8,18 +8,4 @@ config SYS_CONFIG_NAME
 	string
 	default "s32v234pcie"
 
-config PHY_RGMII_DIRECT_CONNECTED
-	bool "Enable fixed PHY for MDIO Bus/PHY emulation with fixed speed/link PHYs"
-	default n
-	help
-	  Adds the platform "fixed" MDIO Bus to cover the boards that use
-	  PHYs that are not connected to the real MDIO bus.
-
-config S32V234_FAST_BOOT
-	bool "Configure DCD and RUNMODE for a fast-boot efused board"
-	default n
-	help
-	  Configure DCD and RUNMODE for a board that has been efused such that
-	  OCOTP_CFG6:[19]FAST_BOOT_ENABLE = 0 and OCOTP_CFG6:[18]NO_PLL = 1.
-
 endif
-- 
2.17.1

