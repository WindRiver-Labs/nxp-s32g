From 1c7ed29deeb173701bb2aa54cf6c68f21fd6078b Mon Sep 17 00:00:00 2001
From: Ciprian Marian Costea <ciprianmarian.costea@nxp.com>
Date: Mon, 8 Nov 2021 09:58:34 +0200
Subject: [PATCH 10/19] s32r45: revision: Print subminor revision

Issue: ALB-8077
Upstream-Status: Pending 

Signed-off-by: Ciprian Marian Costea <ciprianmarian.costea@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 arch/arm/cpu/armv8/s32/s32-gen1/soc.c | 5 +++--
 arch/arm/include/asm/arch-s32/siul.h  | 5 +++++
 2 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/arch/arm/cpu/armv8/s32/s32-gen1/soc.c b/arch/arm/cpu/armv8/s32/s32-gen1/soc.c
index 36ae3fcfcb..70eb2302ea 100644
--- a/arch/arm/cpu/armv8/s32/s32-gen1/soc.c
+++ b/arch/arm/cpu/armv8/s32/s32-gen1/soc.c
@@ -176,9 +176,10 @@ int print_cpuinfo(void)
 	#endif  /* CONFIG_TARGET_TYPE_S32GEN1_SIMULATOR */
 #elif defined(CONFIG_NXP_S32R45)
 	printf("CPU:\tNXP S32R45");
-	printf(" rev. %d.%d\n",
+	printf(" rev. %d.%d.%d\n",
 	       get_siul2_midr1_major() + 1,
-	       get_siul2_midr1_minor());
+	       get_siul2_midr1_minor(),
+		   !get_siul2_midr2_subminor());
 #elif defined(CONFIG_NXP_S32G3XX)
 	printf("CPU:\tNXP S32G398A\n");
 #endif
diff --git a/arch/arm/include/asm/arch-s32/siul.h b/arch/arm/include/asm/arch-s32/siul.h
index dd7840c65a..e9746824bf 100644
--- a/arch/arm/include/asm/arch-s32/siul.h
+++ b/arch/arm/include/asm/arch-s32/siul.h
@@ -59,8 +59,13 @@
 #define SIUL2_MIDR2_FREQ_MASK		(0xF << SIUL2_MIDR2_FREQ_SHIFT)
 
 #ifdef CONFIG_S32_GEN1
+#ifdef CONFIG_NXP_S32R45
+#define SIUL2_MIDR2_SUBMINOR_SHIFT	(0)
+#define SIUL2_MIDR2_SUBMINOR_MASK	(0x1 << SIUL2_MIDR2_SUBMINOR_SHIFT)
+#else
 #define SIUL2_MIDR2_SUBMINOR_SHIFT	(26)
 #define SIUL2_MIDR2_SUBMINOR_MASK	(0xF << SIUL2_MIDR2_SUBMINOR_SHIFT)
+#endif
 #define SIUL2_MIDR1_DERIV_MASK		(0xFFFF0000U)
 #define SIUL2_MIDR1_OFF			(16U)
 #endif  /* CONFIG_S32_GEN1 */
-- 
2.17.1

