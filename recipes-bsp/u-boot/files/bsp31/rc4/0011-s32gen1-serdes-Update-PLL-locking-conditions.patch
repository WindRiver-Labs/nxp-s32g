From 6a12d3c70eabda4a00e9ec3697a43f9784b3b265 Mon Sep 17 00:00:00 2001
From: Ionut Vicovan <Ionut.Vicovan@nxp.com>
Date: Tue, 12 Oct 2021 10:44:28 +0300
Subject: [PATCH 11/11] s32gen1: serdes: Update PLL locking conditions

Issue: ALB-7710

Upstream-Status: Pending 

Signed-off-by: Ionut Vicovan <Ionut.Vicovan@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 drivers/pci/serdes_s32gen1.c | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/drivers/pci/serdes_s32gen1.c b/drivers/pci/serdes_s32gen1.c
index b981ceba75..79a586ee45 100644
--- a/drivers/pci/serdes_s32gen1.c
+++ b/drivers/pci/serdes_s32gen1.c
@@ -387,10 +387,13 @@ bool s32_serdes_init(struct s32_serdes *pcie)
 
 	if (IS_SERDES_PCIE(pcie->devtype)) {
 
-		/* Monitor Serdes MPLL state */
+		/* Monitor Serdes MPLL state, which is 1 when
+		 * either MPLLA is 1 (for Gen1 and 2) or
+		 * MPLLB is 1 (for Gen3)
+		 */
 		if (wait_read32((void *)(pcie->dbi + SS_PHY_MPLLA_CTRL),
-			MPLL_STATE | MPLLA_STATE,
-			MPLL_STATE | MPLLA_STATE,
+			MPLL_STATE,
+			MPLL_STATE,
 			PCIE_MPLL_LOCK_COUNT)) {
 			printf("WARNING: Failed to lock PCIe%d MPLLs\n",
 				pcie->id);
-- 
2.17.1

