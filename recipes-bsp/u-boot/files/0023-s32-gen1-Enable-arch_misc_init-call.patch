From 7db9871227623535228dd7e72edaf81f3605d0d9 Mon Sep 17 00:00:00 2001
From: Ghennadi Procopciuc <Ghennadi.Procopciuc@nxp.com>
Date: Fri, 8 Jan 2021 13:50:37 +0200
Subject: [PATCH 23/76] s32-gen1: Enable arch_misc_init call

Issue: ALB-6278
Signed-off-by: Ghennadi Procopciuc <Ghennadi.Procopciuc@nxp.com>
---
 arch/arm/cpu/armv8/s32/s32-gen1/soc.c | 4 +---
 board/freescale/Kconfig               | 1 +
 configs/s32g274abluebox3_defconfig    | 1 -
 configs/s32g274aevb_defconfig         | 1 -
 configs/s32g274aevb_qspi_defconfig    | 1 -
 5 files changed, 2 insertions(+), 6 deletions(-)

diff --git a/arch/arm/cpu/armv8/s32/s32-gen1/soc.c b/arch/arm/cpu/armv8/s32/s32-gen1/soc.c
index 74cd7e9abc..654614a4a5 100644
--- a/arch/arm/cpu/armv8/s32/s32-gen1/soc.c
+++ b/arch/arm/cpu/armv8/s32/s32-gen1/soc.c
@@ -1,6 +1,6 @@
 // SPDX-License-Identifier:     GPL-2.0+
 /*
- * Copyright 2017-2020 NXP
+ * Copyright 2017-2021 NXP
  */
 
 #include <common.h>
@@ -246,7 +246,6 @@ U_BOOT_CMD(
 		"<start_address>"
 	  );
 
-#ifdef CONFIG_ARCH_MISC_INIT
 int arch_misc_init(void)
 {
 	int ret = 0;
@@ -289,7 +288,6 @@ int arch_misc_init(void)
 #endif
 	return ret;
 }
-#endif
 
 #ifdef CONFIG_FSL_DSPI
 int mmap_dspi(unsigned short bus, struct dspi **base_addr)
diff --git a/board/freescale/Kconfig b/board/freescale/Kconfig
index d93d1c930b..b2ab272856 100644
--- a/board/freescale/Kconfig
+++ b/board/freescale/Kconfig
@@ -10,6 +10,7 @@ config S32_GEN1
 	select OF_CONTROL
 	select OF_SEPARATE
 	select SCMI_FIRMWARE
+	select ARCH_MISC_INIT
 	help
 	  Platform Selection
 
diff --git a/configs/s32g274abluebox3_defconfig b/configs/s32g274abluebox3_defconfig
index 7c658df089..674c01bd9a 100644
--- a/configs/s32g274abluebox3_defconfig
+++ b/configs/s32g274abluebox3_defconfig
@@ -12,7 +12,6 @@ CONFIG_FIT=y
 CONFIG_SD_BOOT=y
 CONFIG_USE_BOOTARGS=y
 CONFIG_ARCH_EARLY_INIT_R=y
-CONFIG_ARCH_MISC_INIT=y
 CONFIG_BOARD_EARLY_INIT_F=y
 CONFIG_BOARD_EARLY_INIT_R=y
 CONFIG_LAST_STAGE_INIT=y
diff --git a/configs/s32g274aevb_defconfig b/configs/s32g274aevb_defconfig
index 51f4c05d6a..9de9d2ec64 100644
--- a/configs/s32g274aevb_defconfig
+++ b/configs/s32g274aevb_defconfig
@@ -12,7 +12,6 @@ CONFIG_FIT=y
 CONFIG_SD_BOOT=y
 CONFIG_USE_BOOTARGS=y
 CONFIG_ARCH_EARLY_INIT_R=y
-CONFIG_ARCH_MISC_INIT=y
 CONFIG_BOARD_EARLY_INIT_F=y
 CONFIG_CMD_EEPROM=y
 CONFIG_CMD_MD5SUM=y
diff --git a/configs/s32g274aevb_qspi_defconfig b/configs/s32g274aevb_qspi_defconfig
index 3d7f9c0fea..2b9a1a1c4a 100644
--- a/configs/s32g274aevb_qspi_defconfig
+++ b/configs/s32g274aevb_qspi_defconfig
@@ -13,7 +13,6 @@ CONFIG_TOOLS_DEBUG=y
 CONFIG_FIT=y
 CONFIG_USE_BOOTARGS=y
 CONFIG_ARCH_EARLY_INIT_R=y
-CONFIG_ARCH_MISC_INIT=y
 CONFIG_BOARD_EARLY_INIT_F=y
 CONFIG_CMD_EEPROM=y
 CONFIG_CMD_MD5SUM=y
-- 
2.17.1

