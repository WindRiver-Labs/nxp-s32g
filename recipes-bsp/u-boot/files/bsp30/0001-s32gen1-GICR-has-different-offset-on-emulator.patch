From 6eb35a3cfd6ff1548f7b2ffc4198a5dcfe86faa3 Mon Sep 17 00:00:00 2001
From: Larisa Grigore <larisa.grigore@nxp.com>
Date: Mon, 29 Mar 2021 15:38:38 +0300
Subject: [PATCH 01/14] s32gen1: GICR has different offset on emulator

Upstream-Status: Pending

Issue: ALB-6122
Signed-off-by: Larisa Grigore <larisa.grigore@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 arch/arm/dts/fsl-s32g398aemu.dts | 17 +++++++++++++++++
 include/configs/s32-gen1.h       |  4 ++++
 2 files changed, 21 insertions(+)

diff --git a/arch/arm/dts/fsl-s32g398aemu.dts b/arch/arm/dts/fsl-s32g398aemu.dts
index 1821d28f86..31fdc1e26c 100644
--- a/arch/arm/dts/fsl-s32g398aemu.dts
+++ b/arch/arm/dts/fsl-s32g398aemu.dts
@@ -6,6 +6,23 @@
 /dts-v1/;
 #include "fsl-s32g398a.dtsi"
 
+/delete-node/ &gic;
+/ {
+	gic: interrupt-controller@50800000 {
+		compatible = "arm,gic-v3";
+		#interrupt-cells = <3>;
+		#address-cells = <2>;
+		#size-cells = <2>;
+		interrupt-controller;
+		reg = <0 0x50800000 0 0x10000>, /* GIC Dist */
+		      <0 0x50900000 0 0x200000>, /* GICR (RD_base + SGI_base) */
+		      <0 0x50400000 0 0x2000>, /* GICC */
+		      <0 0x50410000 0 0x2000>, /* GICH */
+		      <0 0x50420000 0 0x2000>; /* GICV */
+		interrupts = <1 9 0xf04>;
+	};
+};
+
 &usdhc0 {
 	status = "okay";
 };
diff --git a/include/configs/s32-gen1.h b/include/configs/s32-gen1.h
index b0b5fa3042..ca2d6cecde 100644
--- a/include/configs/s32-gen1.h
+++ b/include/configs/s32-gen1.h
@@ -102,8 +102,12 @@
 #define CONFIG_GICV3
 #define GIC_BASE	0x50800000
 #define GICD_BASE	GIC_BASE
+#ifdef CONFIG_TARGET_TYPE_S32GEN1_EMULATOR
+#define GICR_BASE	(GIC_BASE + 0x100000)
+#else
 #define GICR_BASE	(GIC_BASE + 0x80000)
 #endif
+#endif
 
 #define CONFIG_SYS_TEXT_OFFSET      0x00020000
 
-- 
2.17.1

