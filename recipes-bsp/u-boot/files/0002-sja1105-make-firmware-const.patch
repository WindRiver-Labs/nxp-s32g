From f51e7dbc5c246506f6e714ee50fda77eab1e7366 Mon Sep 17 00:00:00 2001
From: Radu Pirea <radu-nicolae.pirea@nxp.com>
Date: Thu, 19 Nov 2020 17:42:33 +0200
Subject: [PATCH 02/76] sja1105: make firmware const.

Make sja1105 firmware const.

Issue: ALB-5671

Signed-off-by: Radu Pirea <radu-nicolae.pirea@nxp.com>
---
 board/freescale/campps32v2/sja1105_cfg.c | 8 ++++----
 drivers/spi/sja1105.c                    | 8 +++-----
 drivers/spi/sja1105_cfg.c                | 2 +-
 include/sja1105_cfg.h                    | 4 ++--
 4 files changed, 10 insertions(+), 12 deletions(-)

diff --git a/board/freescale/campps32v2/sja1105_cfg.c b/board/freescale/campps32v2/sja1105_cfg.c
index 1eaf3ba7a1..e4f06c7461 100644
--- a/board/freescale/campps32v2/sja1105_cfg.c
+++ b/board/freescale/campps32v2/sja1105_cfg.c
@@ -17,7 +17,7 @@
  * To regenerate this, use the file with the following command:
  * 'xxd -i <filename>'
  */
-static u8 sja1105p_1_2_cfg_bin[] = {
+static const u8 sja1105p_1_2_cfg_bin[] = {
 	0x0e, 0x03, 0x00, 0xae, 0x00, 0x00, 0x00, 0x05, 0x05, 0x00, 0x00, 0x00,
 	0x2b, 0xa0, 0x1c, 0x9a, 0x00, 0x00, 0x42, 0x00, 0x00, 0x00, 0x25, 0x04,
 	0xc0, 0x8a, 0xf8, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00,
@@ -108,7 +108,7 @@ static u8 sja1105p_1_2_cfg_bin[] = {
  * To regenerate this, use the file with the following command:
  * 'xxd -i <filename>'
  */
-static u8 sja1105p_2_2_cfg_bin[] = {
+static const u8 sja1105p_2_2_cfg_bin[] = {
 	0x0e, 0x03, 0x00, 0xae, 0x00, 0x00, 0x00, 0x05, 0x05, 0x00, 0x00, 0x00,
 	0x2b, 0xa0, 0x1c, 0x9a, 0x00, 0x00, 0x42, 0x00, 0x00, 0x00, 0x25, 0x04,
 	0xc0, 0x8a, 0xf8, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00,
@@ -193,7 +193,7 @@ static u8 sja1105p_2_2_cfg_bin[] = {
 	0x00, 0x00, 0x00, 0x00, 0x3c, 0xf2, 0xe8, 0x3f
 };
 
-static struct sja1105_cfgs_s sja1105_cfgs_m[] = {
+static const struct sja1105_cfgs_s sja1105_cfgs_m[] = {
 	{SJA1105_VAL_DEVICEID_1_2, 0, ARRAY_SIZE(sja1105p_1_2_cfg_bin),
 		sja1105p_1_2_cfg_bin},
 	{SJA1105_VAL_DEVICEID_2_2, 1, ARRAY_SIZE(sja1105p_2_2_cfg_bin),
@@ -201,4 +201,4 @@ static struct sja1105_cfgs_s sja1105_cfgs_m[] = {
 	{0x0UL, 0, 0, NULL}
 };
 
-struct sja1105_cfgs_s *sja1105_cfgs = &sja1105_cfgs_m[0];
+const struct sja1105_cfgs_s *sja1105_cfgs = &sja1105_cfgs_m[0];
diff --git a/drivers/spi/sja1105.c b/drivers/spi/sja1105.c
index 64c6004014..d10754e4bd 100644
--- a/drivers/spi/sja1105.c
+++ b/drivers/spi/sja1105.c
@@ -319,17 +319,15 @@ bool sja1105_post_cfg_load_check(struct sja_parms *sjap)
 static void sja1105_en_rgmii_txid_by_default(struct sja_parms *sjap, int port)
 {
 	u32 id;
+	u32 reg = SJA1105_CFG_PAD_MIIX_ID_PORT(port);
 
-	id = sja1105_read_reg32(sjap,
-				SJA1105_CFG_PAD_MIIX_ID_PORT(port));
+	id = sja1105_read_reg32(sjap, reg);
 
 	if (id & (SJA1105_CFG_PAD_MIIX_ID_TXC_PD |
 				SJA1105_CFG_PAD_MIIX_ID_TXC_BYPASS)) {
 		id &= ~GENMASK(7, 0);
 		id |= SJA1105_CFG_PAD_MIIX_ID_RGMII_TXID;
-		sja1105_write_reg32(sjap,
-				    SJA1105_CFG_PAD_MIIX_ID_PORT(port),
-				    id);
+		sja1105_write_reg32(sjap, reg, id);
 	}
 }
 
diff --git a/drivers/spi/sja1105_cfg.c b/drivers/spi/sja1105_cfg.c
index 3f4f7ce54c..9c041fba42 100644
--- a/drivers/spi/sja1105_cfg.c
+++ b/drivers/spi/sja1105_cfg.c
@@ -11,7 +11,7 @@
 
 extern struct sja1105_cfgs_s *sja1105_cfgs;
 
-int sja1105_get_cfg(u32 devid, u32 cs, u32 *bin_len, u8 **cfg_bin)
+int sja1105_get_cfg(u32 devid, u32 cs, u32 *bin_len, const u8 **cfg_bin)
 {
 	int i = 0;
 	while (sja1105_cfgs[i].cfg_bin) {
diff --git a/include/sja1105_cfg.h b/include/sja1105_cfg.h
index 039a05e1fd..0e62641d09 100644
--- a/include/sja1105_cfg.h
+++ b/include/sja1105_cfg.h
@@ -1,6 +1,6 @@
 /* SPDX-License-Identifier:    GPL-2.0+
  *
- * Copyright 2019 NXP
+ * Copyright 2019-2020 NXP
  *
  */
 
@@ -9,6 +9,6 @@ struct sja1105_cfgs_s {
 	u32 devid;
 	u32 cs;
 	u32 bin_len;
-	u8 *cfg_bin;
+	const u8 *cfg_bin;
 };
 
-- 
2.17.1

